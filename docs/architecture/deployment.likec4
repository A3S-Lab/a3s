// A3S Agent Operating System - Deployment Model

deployment {

  // ═══════════════════════════════════════════
  //  Production Environment
  // ═══════════════════════════════════════════

  environment prod 'Production' {

    region cloud 'Cloud Region' {

      host gwHost 'Gateway Host' {
        gw = instanceOf a3s.gw {
          title 'a3s-gateway (HA)'
          style { multiple true }
        }
      }

      host agentCluster 'Agent Cluster' {

        microvm vm1 'MicroVM-1' {
          safeclaw1 = instanceOf a3s.safeclaw {
            title 'SafeClaw Instance'
          }
          code1 = instanceOf a3s.code {
            title 'a3s-code Agent'
            style { multiple true }
          }
          lane1 = instanceOf a3s.lane {
            title 'a3s-lane Queue'
          }
        }

        microvm vm2 'MicroVM-2 (TEE)' {
          safeclaw2 = instanceOf a3s.safeclaw {
            title 'SafeClaw (TEE Mode)'
          }
          code2 = instanceOf a3s.code {
            title 'a3s-code Agent (Secure)'
          }
        }
      }

      host inferenceHost 'Inference Host' {
        power = instanceOf a3s.power {
          title 'a3s-power (Multi-GPU)'
          technology 'llama.cpp / CUDA'
        }
      }

      host infraHost 'Infrastructure Host' {
        search = instanceOf a3s.search {
          title 'a3s-search'
        }
        context = instanceOf a3s.context {
          title 'a3s-context'
        }
        event = instanceOf a3s.event {
          title 'a3s-event (NATS)'
        }
        cron = instanceOf a3s.cron {
          title 'a3s-cron'
        }
      }
    }

    cloud.gwHost.gw -> cloud.agentCluster.vm1.safeclaw1 'routes to'
    cloud.gwHost.gw -> cloud.agentCluster.vm2.safeclaw2 'routes sensitive to'
    cloud.agentCluster.vm1.code1 -> cloud.inferenceHost.power 'LLM calls'
    cloud.agentCluster.vm2.code2 -> cloud.inferenceHost.power 'secure LLM calls'
    cloud.agentCluster.vm1.code1 -> cloud.infraHost.search 'search queries'
    cloud.agentCluster.vm1.code1 -> cloud.infraHost.event 'pub/sub'
  }

  // ═══════════════════════════════════════════
  //  Development Environment
  // ═══════════════════════════════════════════

  environment dev 'Development' {

    host devbox 'Developer Machine' {
      gw = instanceOf a3s.gw {
        title 'a3s-gateway (dev)'
      }

      microvm localVm 'Local MicroVM' {
        safeclaw = instanceOf a3s.safeclaw
        code = instanceOf a3s.code
        lane = instanceOf a3s.lane
      }

      power = instanceOf a3s.power {
        title 'a3s-power (CPU mode)'
      }
      search = instanceOf a3s.search
      event = instanceOf a3s.event {
        title 'a3s-event (in-memory)'
      }
    }
  }
}

views {

  deployment view prodDeployment {
    title 'Production Deployment'
    description 'A3S production topology: gateway, MicroVM cluster, inference, infrastructure'

    include prod.**

    autoLayout TopBottom
  }

  deployment view devDeployment {
    title 'Development Deployment'
    description 'Local development setup on a single machine'

    include dev.**

    autoLayout TopBottom
  }
}
