---
title: A3S Event
description: Provider-agnostic event bus with schema validation, encryption, dead letter queues, and observability
---

# A3S Event

A3S Event is a provider-agnostic event system for Rust. All backends implement the `EventProvider` trait — swap between NATS JetStream and in-memory without changing application code.

## Feature Flags

All optional modules are behind feature gates. The minimal core compiles with zero optional dependencies.

| Feature | Default | Description |
|---------|---------|-------------|
| `nats` | ✅ | NATS JetStream provider |
| `encryption` | ✅ | AES-256-GCM payload encryption with key rotation |
| `cloudevents` | ✅ | CloudEvents v1.0 conversion |
| `routing` | ✅ | Broker/Trigger event routing + Event sinks |

```toml
# Full (default)
a3s-event = "0.3"

# Minimal core only
a3s-event = { version = "0.3", default-features = false }

# Pick what you need
a3s-event = { version = "0.3", default-features = false, features = ["nats"] }
```

## Architecture

```
┌──────────────────────────────────────────────────────────┐
│                        EventBus                          │
│                                                          │
│  ┌─────────────┐  ┌──────────────┐  ┌───────────────┐  │
│  │ SchemaReg   │  │  Encryptor   │  │  DLQ Handler  │  │
│  │ validate()  │  │ AES-256-GCM  │  │ MemoryDlq     │  │
│  └──────┬──────┘  └──────┬───────┘  └──────┬────────┘  │
│         │                │                  │            │
│         └────── publish ─┴── subscribe ─────┘            │
│                       │                                  │
│  ┌────────────────────┴────────────────────────────┐    │
│  │              EventProvider (trait)                │    │
│  │  publish · subscribe · durable · history · ack   │    │
│  └──────────────┬──────────────────┬───────────────┘    │
│                 │                  │                      │
│  ┌──────────────┴───┐  ┌──────────┴──────────┐         │
│  │  MemoryProvider   │  │   NatsProvider      │         │
│  │  tokio::broadcast │  │   JetStream         │         │
│  │  zero deps        │  │   durable subs      │         │
│  └──────────────────┘  └─────────────────────┘         │
│                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ StateStore   │  │ EventMetrics │  │ Broker       │  │
│  │ File / Memory│  │ lock-free    │  │ routing ⚑    │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└──────────────────────────────────────────────────────────┘

⚑ = behind feature gate
```

## Provider Comparison

| Capability | MemoryProvider | NatsProvider |
|------------|---------------|--------------|
| Publish/Subscribe | ✅ | ✅ |
| History/Replay | In-memory buffer | JetStream stream |
| Durable Subscriptions | No | ✅ |
| Wildcards | ✅ (`>`, `*`) | ✅ (NATS subjects) |
| Deduplication | No | ✅ (msg_id) |
| Manual Ack/Nak | No | ✅ |
| Backpressure | No | ✅ (max_ack_pending) |
| Health Check | Always healthy | Connection check |
| Persistence | None | File or memory storage |
| Use Case | Development, testing | Production |

## Core Types

| Type | Description |
|------|-------------|
| `EventProvider` | Core trait — all backends implement this |
| `EventBus` | High-level API with subscription management |
| `Event` | Message envelope (id, subject, category, event_type, version, payload) |
| `ReceivedEvent` | Event with delivery context (sequence, num_delivered, stream) |
| `Subscription` | Async event stream from any provider |
| `PendingEvent` | Event with ack/nak callbacks for manual acknowledgement |
| `SchemaRegistry` | Event type validation with compatibility checks |
| `StateStore` | Trait for persisting subscription state |
| `EventMetrics` | Lock-free atomic counters |
| `DlqHandler` | Dead letter queue trait |

### Feature-Gated Types

| Type | Feature | Description |
|------|---------|-------------|
| `Aes256GcmEncryptor` | `encryption` | AES-256-GCM with key rotation |
| `CloudEvent` | `cloudevents` | CloudEvents v1.0 envelope |
| `Broker` / `Trigger` | `routing` | Knative-inspired event routing |
| `EventSink` | `routing` | Delivery targets: `TopicSink`, `InProcessSink`, `LogSink` |
| `NatsProvider` | `nats` | NATS JetStream distributed provider |

## Test Coverage

176 unit tests + 29 memory integration tests + 9 NATS integration tests + 2 doc tests.
