---
title: A3S Event
description: Provider-agnostic event bus with schema validation, encryption, dead letter queues, and observability
---

import { TypeTable } from 'fumadocs-ui/components/type-table';

# A3S Event

A3S Event is a provider-agnostic event system for Rust. All backends implement the `EventProvider` trait — swap between NATS JetStream and in-memory without changing application code.

## Feature Flags

All optional modules are behind feature gates. The minimal core compiles with zero optional dependencies.

<TypeTable
  type={{
    "nats": {
      description: "Default: ✅ · Description: NATS JetStream provider",
    },
    "encryption": {
      description: "Default: ✅ · Description: AES-256-GCM payload encryption with key rotation",
    },
    "cloudevents": {
      description: "Default: ✅ · Description: CloudEvents v1.0 conversion",
    },
    "routing": {
      description: "Default: ✅ · Description: Broker/Trigger event routing + Event sinks",
    },
  }}
/>

```toml
# Full (default)
a3s-event = "0.3"

# Minimal core only
a3s-event = { version = "0.3", default-features = false }

# Pick what you need
a3s-event = { version = "0.3", default-features = false, features = ["nats"] }
```

## Architecture

```
┌──────────────────────────────────────────────────────────┐
│                        EventBus                          │
│                                                          │
│  ┌─────────────┐  ┌──────────────┐  ┌───────────────┐  │
│  │ SchemaReg   │  │  Encryptor   │  │  DLQ Handler  │  │
│  │ validate()  │  │ AES-256-GCM  │  │ MemoryDlq     │  │
│  └──────┬──────┘  └──────┬───────┘  └──────┬────────┘  │
│         │                │                  │            │
│         └────── publish ─┴── subscribe ─────┘            │
│                       │                                  │
│  ┌────────────────────┴────────────────────────────┐    │
│  │              EventProvider (trait)                │    │
│  │  publish · subscribe · durable · history · ack   │    │
│  └──────────────┬──────────────────┬───────────────┘    │
│                 │                  │                      │
│  ┌──────────────┴───┐  ┌──────────┴──────────┐         │
│  │  MemoryProvider   │  │   NatsProvider      │         │
│  │  tokio::broadcast │  │   JetStream         │         │
│  │  zero deps        │  │   durable subs      │         │
│  └──────────────────┘  └─────────────────────┘         │
│                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ StateStore   │  │ EventMetrics │  │ Broker       │  │
│  │ File / Memory│  │ lock-free    │  │ routing ⚑    │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└──────────────────────────────────────────────────────────┘

⚑ = behind feature gate
```

## Provider Comparison

<TypeTable
  type={{
    "Publish/Subscribe": {
      description: "MemoryProvider: ✅ · NatsProvider: ✅",
    },
    "History/Replay": {
      description: "MemoryProvider: In-memory buffer · NatsProvider: JetStream stream",
    },
    "Durable Subscriptions": {
      description: "MemoryProvider: No · NatsProvider: ✅",
    },
    "Wildcards": {
      description: {`MemoryProvider: ✅ (\`>\`, \`*\`) · NatsProvider: ✅ (NATS subjects)`},
    },
    "Deduplication": {
      description: "MemoryProvider: No · NatsProvider: ✅ (msg_id)",
    },
    "Manual Ack/Nak": {
      description: "MemoryProvider: No · NatsProvider: ✅",
    },
    "Backpressure": {
      description: "MemoryProvider: No · NatsProvider: ✅ (max_ack_pending)",
    },
    "Health Check": {
      description: "MemoryProvider: Always healthy · NatsProvider: Connection check",
    },
    "Persistence": {
      description: "MemoryProvider: None · NatsProvider: File or memory storage",
    },
    "Use Case": {
      description: "MemoryProvider: Development, testing · NatsProvider: Production",
    },
  }}
/>

## Core Types

<TypeTable
  type={{
    "EventProvider": {
      description: "Core trait — all backends implement this",
    },
    "EventBus": {
      description: "High-level API with subscription management",
    },
    "Event": {
      description: "Message envelope (id, subject, category, event_type, version, payload)",
    },
    "ReceivedEvent": {
      description: "Event with delivery context (sequence, num_delivered, stream)",
    },
    "Subscription": {
      description: "Async event stream from any provider",
    },
    "PendingEvent": {
      description: "Event with ack/nak callbacks for manual acknowledgement",
    },
    "SchemaRegistry": {
      description: "Event type validation with compatibility checks",
    },
    "StateStore": {
      description: "Trait for persisting subscription state",
    },
    "EventMetrics": {
      description: "Lock-free atomic counters",
    },
    "DlqHandler": {
      description: "Dead letter queue trait",
    },
  }}
/>

### Feature-Gated Types

<TypeTable
  type={{
    "Aes256GcmEncryptor": {
      description: {`Feature: \`encryption\` · Description: AES-256-GCM with key rotation`},
    },
    "CloudEvent": {
      description: {`Feature: \`cloudevents\` · Description: CloudEvents v1.0 envelope`},
    },
    "Broker\` / \`Trigger": {
      description: {`Feature: \`routing\` · Description: Knative-inspired event routing`},
    },
    "EventSink": {
      description: {`Feature: \`routing\` · Description: Delivery targets: \`TopicSink\`, \`InProcessSink\`, \`LogSink\``},
    },
    "NatsProvider": {
      description: {`Feature: \`nats\` · Description: NATS JetStream distributed provider`},
    },
  }}
/>

## Test Coverage

176 unit tests + 29 memory integration tests + 9 NATS integration tests + 2 doc tests.
