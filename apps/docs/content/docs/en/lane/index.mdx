---
title: A3S Lane
description: Priority-based command queue for async task scheduling — Rust, Python, and Node.js
---

import { TypeTable } from 'fumadocs-ui/components/type-table';

# A3S Lane

A3S Lane is a priority-based command queue for async task scheduling. Six built-in lanes with configurable concurrency ensure control commands always preempt LLM generation. Available as a Rust crate, Python package, and Node.js module.

## Key Features

- **Priority Scheduling** — 6 built-in lanes. The highest-priority lane with pending work is always scheduled next.
- **Concurrency Control** — Per-lane semaphore limits with configurable min/max.
- **Retry Policies** — Exponential backoff and fixed-delay strategies.
- **Dead Letter Queue** — Failed commands captured with full context for inspection.
- **Persistent Storage** — Pluggable storage backend (local filesystem included).
- **Event Stream** — `EventStream` implements `futures_core::Stream`; subscribe directly from the manager without threading `EventEmitter` manually.
- **Lane Pressure Events** — `queue.lane.pressure` / `queue.lane.idle` when queue depth crosses a configured threshold.
- **Rate Limiting** — Token bucket per lane (`distributed` feature).
- **Priority Boosting** — Deadline-based automatic priority escalation (`distributed` feature).
- **Queue Partitioning** — Round-robin and hash-based partitioning for multi-core parallelism.
- **Metrics & Alerts** — Latency histograms, queue depth tracking, and configurable alert thresholds.
- **Graceful Shutdown** — Drain pending commands before stopping.

## Architecture

```
QueueManager
├── EventEmitter          ← broadcast pub/sub; subscribe() returns EventStream (Stream)
├── CommandQueue           ← scheduler (10ms poll loop)
│   ├── Lanes              ← HashMap<LaneId, Lane>
│   │   └── Lane           ← priority queue + concurrency semaphore
│   │       ├── Pending    ← VecDeque (FIFO within priority)
│   │       └── Config     ← timeout, retry, rate limit, boost, pressure threshold
│   ├── DeadLetterQueue    ← failed commands
│   └── Storage            ← optional persistence
├── Metrics                ← optional observability
└── Alerts                 ← optional monitoring
```

## Built-in Lanes

<TypeTable
  type={
    "system": {
      description: "Priority: 0 (highest) · Max Concurrency: 5 · Use Case: System-level operations",
    },
    "control": {
      description: "Priority: 1 · Max Concurrency: 3 · Use Case: Pause, resume, cancel",
    },
    "query": {
      description: "Priority: 2 · Max Concurrency: 10 · Use Case: Read-only queries",
    },
    "session": {
      description: "Priority: 3 · Max Concurrency: 5 · Use Case: Session management",
    },
    "skill": {
      description: "Priority: 4 · Max Concurrency: 3 · Use Case: Skill/tool execution",
    },
    "prompt": {
      description: "Priority: 5 (lowest) · Max Concurrency: 2 · Use Case: LLM prompt processing",
    },
  }
/>

Lower priority number = higher priority. The scheduler always picks commands from the highest-priority lane with pending work.

## Supported Languages

<TypeTable
  type={
    "Rust": {
      description: {`Package: [\`a3s-lane\`](https://crates.io/crates/a3s-lane) · Install: \`a3s-lane = "0.4"\` in Cargo.toml`},
    },
    "Python": {
      description: {`Package: [\`a3s-lane\`](https://pypi.org/project/a3s-lane/) · Install: \`pip install a3s-lane\``},
    },
    "Node.js": {
      description: {`Package: [\`@a3s-lab/lane\`](https://www.npmjs.com/package/@a3s-lab/lane) · Install: \`npm install @a3s-lab/lane\``},
    },
  }
/>

## Performance

Benchmarked on Apple Silicon (M-series), release build:

<TypeTable
  type={
    "Concurrent (10 lanes)": {
      description: "33,000–50,000 ops/sec",
    },
    "Single lane": {
      description: "6,600–10,000 ops/sec",
    },
    "Full lifecycle (create/start/shutdown overhead)": {
      description: "~85–93 ops/sec",
    },
    "Metrics overhead": {
      description: "~3–5%",
    },
  }
/>

## Test Coverage

246 tests (`--all-features`). Key modules at 98–100% line coverage.
