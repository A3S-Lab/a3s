---
title: Memory
description: Persistent file-based memory store across sessions
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';
import { Callout } from 'fumadocs-ui/components/callout';

# Memory

A3S Code supports persistent long-term memory via `MemoryStore`. The default implementation stores memories as JSON files on disk, surviving across sessions.

## File Memory

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">
```rust
use a3s_code_core::{Agent, SessionOptions};

let opts = SessionOptions::new()
    .with_permissive_policy()
    .with_file_memory("/var/lib/a3s/memory"); // persists across sessions

let session = agent.session("/my-project", Some(opts))?;

// Agent can store and recall facts across sessions
let result = session.send(
    "Remember that this project uses PostgreSQL 15 and deploys to AWS us-east-1",
    None,
).await?;
println!("{}", result.text);

// In a future session with the same memory dir, the agent recalls this
```

**Run:** `cargo run --example test_auto_compact`
**Source:** [`core/examples/test_auto_compact.rs`](https://github.com/A3S-Lab/Code/blob/main/core/examples/test_auto_compact.rs)
</Tab>
<Tab value="Python">
```python
from a3s_code import SessionOptions

opts = SessionOptions()
opts.memory_dir = "/var/lib/a3s/memory"

session = agent.session("/my-project", options=opts)

result = await session.send(
    "Remember that this project uses PostgreSQL 15 and deploys to AWS us-east-1"
)
print(result.text)
```

**Run:** `python examples/test_advanced_features.py`
**Source:** [`sdk/python/examples/test_advanced_features.py`](https://github.com/A3S-Lab/Code/blob/main/sdk/python/examples/test_advanced_features.py)
</Tab>
<Tab value="Node.js">
```javascript
const session = agent.session('/my-project', {
  permissive: true,
  memoryDir: '/var/lib/a3s/memory',
});

const result = await session.send(
  'Remember that this project uses PostgreSQL 15 and deploys to AWS us-east-1'
);
console.log(result.text);
```

**Run:** `node examples/test_advanced_features.js`
**Source:** [`sdk/node/examples/test_advanced_features.js`](https://github.com/A3S-Lab/Code/blob/main/sdk/node/examples/test_advanced_features.js)
</Tab>
</Tabs>

## Custom Memory Store

Implement `MemoryStore` to use any backend (Redis, SQLite, vector DB, etc.).

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">
```rust
use a3s_code_core::memory::{AgentMemory, MemoryStore, MemoryEntry, MemoryType};
use std::sync::Arc;

// Implement your own store
struct RedisMemoryStore { /* ... */ }

impl MemoryStore for RedisMemoryStore {
    async fn store(&self, entry: MemoryEntry) -> anyhow::Result<String> { /* ... */ }
    async fn recall(&self, query: &str, limit: usize) -> anyhow::Result<Vec<MemoryEntry>> { /* ... */ }
    async fn delete(&self, id: &str) -> anyhow::Result<()> { /* ... */ }
    async fn clear(&self) -> anyhow::Result<()> { /* ... */ }
}

let opts = SessionOptions::new()
    .with_permissive_policy()
    .with_memory(Arc::new(RedisMemoryStore::new()));

let session = agent.session("/my-project", Some(opts))?;
```
</Tab>
<Tab value="Python">
```python
# Custom memory stores are implemented in Rust and exposed via the SDK.
# Use the built-in file memory for most use cases:
opts = SessionOptions()
opts.memory_dir = "/path/to/memory"
session = agent.session("/my-project", options=opts)
```
</Tab>
<Tab value="Node.js">
```javascript
// Custom memory stores are implemented in Rust and exposed via the SDK.
// Use the built-in file memory for most use cases:
const session = agent.session('/my-project', {
  memoryDir: '/path/to/memory',
});
```
</Tab>
</Tabs>

## Memory Events

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">
```rust
while let Some(event) = rx.recv().await {
    match event {
        AgentEvent::MemoryStored { memory_id, memory_type } => {
            println!("Stored memory: {} ({})", memory_id, memory_type);
        }
        AgentEvent::MemoryRecalled { memory_id, .. } => {
            println!("Recalled memory: {}", memory_id);
        }
        _ => {}
    }
}
```
</Tab>
<Tab value="Python">
```python
async for event in session.stream("What do you remember about this project?"):
    if event.get("type") == "memory_stored":
        print(f"Stored: {event['memory_id']}")
    elif event.get("type") == "memory_recalled":
        print(f"Recalled: {event['memory_id']}")
    elif event.get("type") == "end":
        break
```
</Tab>
<Tab value="Node.js">
```javascript
for await (const event of stream) {
  if (event.type === 'memory_stored') {
    console.log(`Stored: ${event.memoryId}`);
  } else if (event.type === 'memory_recalled') {
    console.log(`Recalled: ${event.memoryId}`);
  } else if (event.type === 'end') break;
}
```
</Tab>
</Tabs>

<Callout type="info">
For full memory API reference, see [Memory](/docs/code/memory).
</Callout>

## API Reference

### SessionOptions

| Option | Rust | Python | Node.js | Default |
|--------|------|--------|---------|---------|
| File memory | `.with_file_memory(path)` | `memory_dir=path` | `memoryDir: path` | `None` |
| Custom store | `.with_memory(Arc::new(store))` | _(Rust only)_ | _(Rust only)_ | `InMemoryStore` |

### MemoryStore trait (Rust)

| Method | Signature | Description |
|--------|-----------|-------------|
| `store` | `async fn store(&self, entry: MemoryEntry) -> Result<String>` | Persist a memory, returns ID |
| `recall` | `async fn recall(&self, query: &str, limit: usize) -> Result<Vec<MemoryEntry>>` | Retrieve relevant memories |
| `delete` | `async fn delete(&self, id: &str) -> Result<()>` | Remove a memory by ID |
| `clear` | `async fn clear(&self) -> Result<()>` | Wipe all memories |

### Memory Events

| Event | Rust variant | Python/Node.js `type` | Fields |
|-------|-------------|----------------------|--------|
| Memory stored | `AgentEvent::MemoryStored` | `memory_stored` | `memory_id`, `memory_type` |
| Memory recalled | `AgentEvent::MemoryRecalled` | `memory_recalled` | `memory_id`, `relevance` |
