---
title: Planning
description: Task decomposition with goal tracking
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';
import { TypeTable } from 'fumadocs-ui/components/type-table';
import { Callout } from 'fumadocs-ui/components/callout';

# Planning

Planning mode decomposes a complex prompt into a structured execution plan before running. Each step is tracked independently, enabling goal-oriented multi-step tasks.

<Callout type="info">
Planning adds one extra LLM call to generate the plan. Use it for complex multi-file tasks; skip it for simple queries.
</Callout>

## Enable Planning

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">
```rust
use a3s_code_core::{Agent, SessionOptions};

let opts = SessionOptions::new()
    .with_permissive_policy()
    .with_planning(true)
    .with_goal_tracking(true);

let session = agent.session("/my-project", Some(opts))?;

let result = session.send(
    "Add input validation to all API endpoints, write tests, and update the README",
    None,
).await?;

println!("{}", result.text);
println!("Tool calls: {}", result.tool_calls_count);
```

**Run:** `cargo run --example agentic_loop_demo`
**Source:** [`core/examples/agentic_loop_demo.rs`](https://github.com/A3S-Lab/Code/blob/main/core/examples/agentic_loop_demo.rs)
</Tab>
<Tab value="Python">
```python
session = agent.session("/my-project",
    permissive=True,
    planning=True,
    goal_tracking=True,
)

result = await session.send(
    "Add input validation to all API endpoints, write tests, and update the README"
)

print(result.text)
print(f"Tool calls: {result.tool_calls_count}")
```

**Source:** [`sdk/python/examples/agentic_loop_demo.py`](https://github.com/A3S-Lab/Code/blob/main/sdk/python/examples/agentic_loop_demo.py)
</Tab>
<Tab value="Node.js">
```javascript
const session = agent.session('/my-project', {
  permissive: true,
  planning: true,
  goalTracking: true,
});

const result = await session.send(
  'Add input validation to all API endpoints, write tests, and update the README'
);

console.log(result.text);
console.log(`Tool calls: ${result.toolCallsCount}`);
```

**Source:** [`sdk/node/examples/agentic_loop_demo.js`](https://github.com/A3S-Lab/Code/blob/main/sdk/node/examples/agentic_loop_demo.js)
</Tab>
</Tabs>

## Streaming Planning Events

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">
```rust
let (mut rx, handle) = session.stream("Refactor and test the auth module", None).await?;

while let Some(event) = rx.recv().await {
    match event {
        AgentEvent::PlanningStart { prompt } => {
            println!(" Planning: {}", prompt);
        }
        AgentEvent::PlanReady { steps, .. } => {
            println!("Plan ({} steps):", steps.len());
            for (i, step) in steps.iter().enumerate() {
                println!("  {}. {}", i + 1, step);
            }
        }
        AgentEvent::End { .. } => break,
        _ => {}
    }
}
handle.await??;
```
</Tab>
<Tab value="Python">
```python
async for event in session.stream("Refactor and test the auth module"):
    t = event.get("type")
    if t == "planning_start":
        print(f" Planning: {event['prompt']}")
    elif t == "plan_ready":
        print(f"Plan ({len(event['steps'])} steps):")
        for i, step in enumerate(event["steps"], 1):
            print(f"  {i}. {step}")
    elif t == "end":
        break
```
</Tab>
<Tab value="Node.js">
```javascript
for await (const event of stream) {
  if (event.type === 'planning_start') {
    console.log(` Planning: ${event.prompt}`);
  } else if (event.type === 'plan_ready') {
    console.log(`Plan (${event.steps.length} steps):`);
    event.steps.forEach((step, i) => console.log(`  ${i + 1}. ${step}`));
  } else if (event.type === 'end') {
    break;
  }
}
```
</Tab>
</Tabs>

## API Reference

### SessionOptions

<TypeTable
  type={{
    "Enable planning": {
      description: {`Rust: \`.with_planning(true)\` 路 Python: \`planning=True\` 路 Node.js: \`planning: true\` 路 Default: \`false\``},
    },
    "Enable goal tracking": {
      description: {`Rust: \`.with_goal_tracking(true)\` 路 Python: \`goal_tracking=True\` 路 Node.js: \`goalTracking: true\` 路 Default: \`false\``},
    },
  }}
/>

### Planning Events

<TypeTable
  type={{
    "Planning started": {
      description: {`Rust variant: \`AgentEvent::PlanningStart\` 路 Python/Node.js \`type\`: \`planning_start\` 路 Fields: \`prompt\``},
    },
    "Plan generated": {
      description: {`Rust variant: \`AgentEvent::PlanReady\` 路 Python/Node.js \`type\`: \`plan_ready\` 路 Fields: \`steps[]\`, \`wave_count\``},
    },
    "Step started": {
      description: {`Rust variant: \`AgentEvent::StepStart\` 路 Python/Node.js \`type\`: \`step_start\` 路 Fields: \`step\`, \`index\``},
    },
    "Step completed": {
      description: {`Rust variant: \`AgentEvent::StepEnd\` 路 Python/Node.js \`type\`: \`step_end\` 路 Fields: \`step\`, \`index\`, \`success\``},
    },
    "Goal updated": {
      description: {`Rust variant: \`AgentEvent::GoalUpdated\` 路 Python/Node.js \`type\`: \`goal_updated\` 路 Fields: \`goal\`, \`status\``},
    },
  }}
/>
