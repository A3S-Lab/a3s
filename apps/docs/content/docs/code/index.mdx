---
title: A3S Code
description: Embeddable AI coding agent framework in Rust with native Node.js and Python bindings
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';
import { Callout } from 'fumadocs-ui/components/callout';

# A3S Code

**Embeddable AI coding agent framework in Rust** ‚Äî Build AI agents that read, write, and execute code with tool access, planning, safety controls, and multi-machine distribution.

```rust
let agent = Agent::new("agent.hcl").await?;
let session = agent.session(".", None)?;
let result = session.send("Refactor auth to use JWT", None).await?;
```

<Callout type="info">
**Test Coverage:** 1158 tests, 100% pass rate | **Extension Points:** 14 trait-based | **Built-in Tools:** 11
</Callout>

## Why A3S Code?

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
  <div className="border rounded-lg p-4">
    <h3 className="text-lg font-semibold mb-2">üîß Embeddable</h3>
    <span className="text-sm text-muted-foreground">Rust library, not a service. Integrate into your app with Node.js/Python bindings.</span>
  </div>

  <div className="border rounded-lg p-4">
    <h3 className="text-lg font-semibold mb-2">üõ°Ô∏è Production-Ready</h3>
    <span className="text-sm text-muted-foreground">Permission system, HITL confirmation, skill-based tool restrictions.</span>
  </div>

  <div className="border rounded-lg p-4">
    <h3 className="text-lg font-semibold mb-2">üîå Extensible</h3>
    <span className="text-sm text-muted-foreground">14 trait-based extension points. Replace any policy with your own implementation.</span>
  </div>

  <div className="border rounded-lg p-4">
    <h3 className="text-lg font-semibold mb-2">üìà Scalable</h3>
    <span className="text-sm text-muted-foreground">Lane-based priority queue with multi-machine task distribution.</span>
  </div>
</div>

## Quick Start

### Installation

<Tabs groupId="lang" items={['Rust', 'TypeScript', 'Python']}>
<Tab value="Rust">
```bash
cargo add a3s-code-core
```
</Tab>
<Tab value="TypeScript">
```bash
npm install @a3s-lab/code
```
</Tab>
<Tab value="Python">
```bash
pip install a3s-code
```
</Tab>
</Tabs>

### Configuration

Create `agent.hcl`:

```hcl
default_model = "anthropic/claude-sonnet-4-20250514"

providers {
  name    = "anthropic"
  api_key = env("ANTHROPIC_API_KEY")
}
```

<Callout type="info">
A3S Code uses HCL configuration format exclusively. See [Providers](/docs/code/providers) for multi-provider setup and [Lane Queue](/docs/code/lane-queue) for queue configuration.
</Callout>

### Basic Usage

<Tabs groupId="lang" items={['Rust', 'TypeScript', 'Python']}>
<Tab value="Rust">
```rust
use a3s_code_core::{Agent, SessionOptions};

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let agent = Agent::new("agent.hcl").await?;

    // Basic usage
    let session = agent.session(".", None)?;
    let result = session.send("What files handle authentication?", None).await?;
    println!("{}", result.text);

    // With options
    let session = agent.session(".", Some(
        SessionOptions::new()
            .with_default_security()
            .with_builtin_skills()
            .with_planning(true)
    ))?;

    let result = session.send("Refactor auth + update tests", None).await?;
    Ok(())
}
```
</Tab>
<Tab value="TypeScript">
```typescript
import { Agent } from '@a3s-lab/code';

const agent = await Agent.create('agent.hcl');
const session = agent.session('.', {
  defaultSecurity: true,
  builtinSkills: true,
  planning: true,
});

const result = await session.send('Refactor auth + update tests');
console.log(result.text);
```
</Tab>
<Tab value="Python">
```python
from a3s_code import Agent, SessionOptions

agent = Agent("agent.hcl")
session = agent.session(".", SessionOptions(
    default_security=True,
    builtin_skills=True,
    planning=True,
))

result = session.send("Refactor auth + update tests")
print(result.text)
```
</Tab>
</Tabs>

## Core Features

### üõ†Ô∏è Built-in Tools (11)

| Category | Tools | Description |
|----------|-------|-------------|
| **File Operations** | `read`, `write`, `edit`, `patch` | Read/write files, apply diffs |
| **Search** | `grep`, `glob`, `ls` | Search content, find files, list directories |
| **Execution** | `bash` | Execute shell commands |
| **Web** | `web_fetch`, `web_search` | Fetch URLs, search the web |
| **Subagents** | `task` | Delegate to specialized child agents |

See [Tools](/docs/code/tools) for full reference.

### üîí Security & Safety

4 layers of security:

1. **Default Security Provider** ‚Äî Auto-redact sensitive data (SSN, API keys, emails, etc.)
2. **Permission System** ‚Äî Allow/Deny/Ask rules per tool with wildcard matching
3. **Skill-Based Tool Restrictions** ‚Äî Skills define allowed tools via `allowed-tools`
4. **HITL Confirmation** ‚Äî Require human approval for sensitive operations

```rust
SessionOptions::new()
    .with_default_security()           // PII redaction
    .with_permission_checker(policy)   // Tool permissions
    .with_confirmation_manager(mgr)    // Human confirmation
```

See [Security](/docs/code/security) for details.

### üß† Skills System

**7 built-in skills** (4 code assistance + 3 tool documentation). Custom skills are Markdown files with YAML frontmatter (Claude Code compatible):

```markdown
---
name: api-design
description: Review API design
allowed-tools: "read(*), grep(*)"
kind: instruction
---
# API Design Review
Check for RESTful principles, proper error handling, and documentation.
```

```rust
SessionOptions::new()
    .with_builtin_skills()              // Enable built-in skills
    .with_skills_from_dir("./skills")   // Load custom skills
```

See [Skills](/docs/code/skills) for details.

### üéØ Planning & Goal Tracking

Decompose complex tasks into dependency-aware execution plans. Independent steps execute in parallel waves via `tokio::JoinSet`. Goal tracking monitors progress across multiple turns.

```rust
SessionOptions::new()
    .with_planning(true)
    .with_goal_tracking(true)
```

See [Tasks](/docs/code/tasks) for details.

### üö¶ Lane-Based Priority Queue

Tool execution is routed through a priority queue backed by [a3s-lane](/docs/lane):

| Lane | Priority | Tools | Behavior |
|------|----------|-------|----------|
| **Control** | P0 (highest) | pause, resume, cancel | Sequential |
| **Query** | P1 | read, glob, grep, ls, web_fetch, web_search | Parallel |
| **Execute** | P2 | bash, write, edit, delete | Sequential |
| **Generate** | P3 (lowest) | LLM calls | Sequential |

Higher-priority tasks preempt queued lower-priority tasks. Advanced features include retry policies, rate limiting, priority boost, pressure monitoring, and DLQ.

See [Lane Queue](/docs/code/lane-queue) for details.

### üåê Multi-Machine Distribution

Offload tool execution to external workers via three handler modes:

| Mode | Behavior |
|------|----------|
| **Internal** (default) | Execute within agent process |
| **External** | Send to external workers, wait for completion |
| **Hybrid** | Execute internally + notify external observers |

```rust
session.set_lane_handler(SessionLane::Execute, LaneHandlerConfig {
    mode: TaskHandlerMode::External,
    timeout_ms: 120_000,
}).await;

// Worker loop (can run on multiple machines)
let tasks = session.pending_external_tasks().await;
for task in tasks {
    let result = execute_on_worker(&task).await;
    session.complete_external_task(&task.task_id, result).await;
}
```

See [Multi-Machine Distribution](/docs/code/multi-machine) for complete guide.

### üîå Extensibility (14 Extension Points)

All policies are replaceable via traits with working defaults:

| Extension Point | Purpose | Default |
|----------------|---------|---------|
| SecurityProvider | Input taint, output sanitization | DefaultSecurityProvider |
| PermissionChecker | Tool access control | PermissionPolicy |
| ConfirmationProvider | Human confirmation | ConfirmationManager |
| ContextProvider | RAG retrieval | FileSystemContextProvider |
| SessionStore | Session persistence | FileSessionStore |
| MemoryStore | Long-term memory | InMemoryStore |
| Tool | Custom tools | 11 built-in tools |
| Planner | Task decomposition | LlmPlanner |
| HookHandler | Event handling | HookEngine |
| HookExecutor | Event execution | HookEngine |
| McpTransport | MCP protocol | StdioTransport |
| HttpClient | HTTP requests | ReqwestClient |
| SessionCommand | Queue tasks | ToolCommand |
| LlmClient | LLM interface | Anthropic/OpenAI |

See [Architecture](/docs/code/architecture) for details.

## Architecture

5 core components (stable, not replaceable) + 14 extension points (replaceable via traits):

```
Agent (config-driven)
  ‚îî‚îÄ‚îÄ AgentSession (workspace-bound)
        ‚îú‚îÄ‚îÄ AgentLoop (core execution engine)
        ‚îÇ     ‚îú‚îÄ‚îÄ ToolExecutor (11 built-in tools)
        ‚îÇ     ‚îú‚îÄ‚îÄ Planning (task decomposition + wave execution)
        ‚îÇ     ‚îî‚îÄ‚îÄ HITL Confirmation
        ‚îú‚îÄ‚îÄ SessionLaneQueue (a3s-lane backed)
        ‚îÇ     ‚îú‚îÄ‚îÄ Control (P0) ‚Üí Query (P1) ‚Üí Execute (P2) ‚Üí Generate (P3)
        ‚îÇ     ‚îî‚îÄ‚îÄ External Task Distribution
        ‚îú‚îÄ‚îÄ HookEngine (8 lifecycle events)
        ‚îú‚îÄ‚îÄ Security (PII redaction, injection detection)
        ‚îú‚îÄ‚îÄ Skills (instruction injection + tool permissions)
        ‚îú‚îÄ‚îÄ Context (RAG providers)
        ‚îî‚îÄ‚îÄ Memory (episodic, semantic, procedural, working)
```

See [Architecture](/docs/code/architecture) for detailed documentation.

## Advanced Features

### Context Providers (RAG)

```rust
let fs_provider = Arc::new(FileSystemContextProvider::new(
    FileSystemContextConfig::new(".")
        .with_include_patterns(vec!["**/*.rs".to_string()])
));

SessionOptions::new().with_context_provider(fs_provider)
```

See [Context](/docs/code/context) for details.

### MCP Integration

```rust
let mcp_client = McpClient::connect_stdio("path/to/mcp-server").await?;
session.add_mcp_client(mcp_client).await;
```

See [MCP](/docs/code/mcp) for details.

### Lifecycle Hooks

8 hook events: PreToolUse, PostToolUse, GenerateStart, GenerateEnd, SessionStart, SessionEnd, SkillLoad, SkillUnload.

```rust
let hook_engine = HookEngine::new();
hook_engine.register(Hook::new("audit", HookEventType::PreToolUse));
SessionOptions::new().with_hook_engine(hook_engine)
```

See [Hooks](/docs/code/hooks) for details.

### Memory System

4 memory types: episodic, semantic, procedural, working. File-based persistence via `FileMemoryStore` (default) or custom backends via `MemoryStore` trait.

```rust
SessionOptions::new()
    .with_file_memory(".a3s/memory")  // File-based persistence
```

See [Memory](/docs/code/memory) for details.

## Documentation

### Getting Started
- **[Quick Start](#quick-start)** ‚Äî Get started in 3 steps
- **[Examples](/docs/code/examples)** ‚Äî Integration tests and usage patterns

### Core Concepts
- **[Architecture](/docs/code/architecture)** ‚Äî System design and components
- **[Sessions](/docs/code/sessions)** ‚Äî Session management and lifecycle
- **[Tasks](/docs/code/tasks)** ‚Äî Planning and wave-based execution
- **[Lane Queue](/docs/code/lane-queue)** ‚Äî Priority routing and queue features

### Security & Safety
- **[Security](/docs/code/security)** ‚Äî Permission system, PII redaction, HITL
- **[Skills](/docs/code/skills)** ‚Äî Skill system and tool restrictions

### Tools & Capabilities
- **[Tools](/docs/code/tools)** ‚Äî Built-in tools reference
- **[MCP](/docs/code/mcp)** ‚Äî External tool integration
- **[Subagents](/docs/code/subagents)** ‚Äî Delegate to specialized agents

### Extensions
- **[Multi-Machine](/docs/code/multi-machine)** ‚Äî Horizontal scaling guide
- **[Hooks](/docs/code/hooks)** ‚Äî Lifecycle events
- **[Memory](/docs/code/memory)** ‚Äî Long-term memory
- **[Context](/docs/code/context)** ‚Äî RAG providers
- **[Persistence](/docs/code/persistence)** ‚Äî Session storage
- **[Telemetry](/docs/code/telemetry)** ‚Äî Cost tracking and metrics
- **[Providers](/docs/code/providers)** ‚Äî LLM provider configuration

## Testing

```bash
cargo test          # All tests
cargo test --lib    # Unit tests only
```

**Test Coverage:** 1158 tests, 100% pass rate

## License

MIT License

## Related Projects

- **[A3S Lane](/docs/lane)** ‚Äî Priority-based task queue with DLQ
- **[A3S Search](/docs/search)** ‚Äî Multi-engine web search aggregator
- **[A3S Box](/docs/box)** ‚Äî Secure sandbox runtime with TEE support
- **[A3S Event](/docs/event)** ‚Äî Event-driven architecture primitives
