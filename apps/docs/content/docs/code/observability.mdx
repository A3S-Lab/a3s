---
title: Observability
description: Tool metrics, cost tracking, and queue statistics
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';

# Observability

Monitor agent performance with per-tool metrics, cost summaries, and task queue statistics.

## Tool Metrics

Get execution metrics for tools â€” call counts, success/failure rates, and timing.

<Tabs groupId="lang" items={['TypeScript', 'Python']}>
<Tab value="TypeScript">
```typescript
const metrics = await client.getToolMetrics(sessionId);
console.log(`Total calls: ${metrics.totalCalls}`);
console.log(`Total duration: ${metrics.totalDurationMs}ms`);

for (const tool of metrics.tools) {
  console.log(`${tool.toolName}:`);
  console.log(`  Calls: ${tool.totalCalls} (${tool.successCount} ok, ${tool.failureCount} fail)`);
  console.log(`  Avg: ${tool.avgDurationMs}ms (min: ${tool.minDurationMs}, max: ${tool.maxDurationMs})`);
  console.log(`  Last called: ${tool.lastCalledAt}`);
}
```
</Tab>
<Tab value="Python">
```python
result = await client.get_tool_metrics(session_id)
for tool in result["tools"]:
    print(f"{tool['tool_name']}: {tool['total_calls']} calls, avg {tool['avg_duration_ms']}ms")
```
</Tab>
</Tabs>

Filter by tool name:

```typescript
const bashMetrics = await client.getToolMetrics(sessionId, { toolName: 'Bash' });
```

### Tool Stats Fields

| Field | Type | Description |
|-------|------|-------------|
| `toolName` | string | Tool name |
| `totalCalls` | number | Total invocations |
| `successCount` | number | Successful calls |
| `failureCount` | number | Failed calls |
| `totalDurationMs` | number | Cumulative execution time |
| `minDurationMs` | number | Fastest execution |
| `maxDurationMs` | number | Slowest execution |
| `avgDurationMs` | number | Average execution time |
| `lastCalledAt` | string | ISO 8601 timestamp of last call |

## Cost Summary

Get token cost breakdown by model and day. Supports filtering by session, model, and date range.

<Tabs groupId="lang" items={['TypeScript', 'Python']}>
<Tab value="TypeScript">
```typescript
const cost = await client.getCostSummary({
  sessionId: sessionId,       // Optional: filter to session
  model: 'claude-sonnet-4-20250514',   // Optional: filter by model
  startDate: '2025-01-01',   // Optional: date range start
  endDate: '2025-01-31',     // Optional: date range end
});

console.log(`Total cost: $${cost.totalCostUsd.toFixed(4)}`);
console.log(`Tokens: ${cost.totalTokens} (${cost.totalPromptTokens} in, ${cost.totalCompletionTokens} out)`);
console.log(`Calls: ${cost.callCount}`);

// Breakdown by model
for (const m of cost.byModel) {
  console.log(`  ${m.model}: $${m.cost.toFixed(4)} (${m.calls} calls, ${m.tokens} tokens)`);
}

// Breakdown by day
for (const d of cost.byDay) {
  console.log(`  ${d.date}: $${d.cost.toFixed(4)} (${d.calls} calls)`);
}
```
</Tab>
<Tab value="Python">
```python
result = await client.get_cost_summary(session_id=session_id)
print(f"Total: ${result['total_cost_usd']:.4f}")
for m in result["by_model"]:
    print(f"  {m['model']}: ${m['cost']:.4f} ({m['calls']} calls)")
```
</Tab>
</Tabs>

### Cost Summary Fields

| Field | Type | Description |
|-------|------|-------------|
| `totalCostUsd` | number | Total estimated cost in USD |
| `totalPromptTokens` | number | Total input tokens |
| `totalCompletionTokens` | number | Total output tokens |
| `totalTokens` | number | Total tokens (input + output) |
| `callCount` | number | Number of LLM calls |
| `byModel` | array | Breakdown per model |
| `byDay` | array | Breakdown per day |

## Queue Statistics

Get task queue depth per lane. Useful for monitoring backpressure.

<Tabs groupId="lang" items={['TypeScript', 'Python']}>
<Tab value="TypeScript">
```typescript
const stats = await client.getQueueStats(sessionId);
console.log('Lane stats:');
for (const [lane, s] of Object.entries({
  control: stats.control,
  query: stats.query,
  execute: stats.execute,
  generate: stats.generate,
})) {
  console.log(`  ${lane}: ${s.pending} pending, ${s.active} active, ${s.completed} done, ${s.failed} failed`);
}
console.log(`Dead letters: ${stats.deadLetters}`);
```
</Tab>
<Tab value="Python">
```python
result = await client.get_queue_stats(session_id)
for lane in ["control", "query", "execute", "generate"]:
    s = result[lane]
    print(f"{lane}: {s['pending']} pending, {s['active']} active")
```
</Tab>
</Tabs>

### Lane Stats Fields

| Field | Type | Description |
|-------|------|-------------|
| `pending` | number | Tasks waiting in queue |
| `active` | number | Tasks currently executing |
| `external` | number | Tasks waiting for external completion |
| `completed` | number | Successfully completed tasks |
| `failed` | number | Failed tasks |

## RPCs

| RPC | Description |
|-----|-------------|
| `getToolMetrics(sessionId, toolName)` | Per-tool execution metrics |
| `getCostSummary(sessionId)` | Per-session token cost summary |
| `getQueueStats(sessionId)` | Lane queue statistics |
