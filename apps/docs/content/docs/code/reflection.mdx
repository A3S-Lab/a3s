---
title: Reflection
description: Adaptive tool execution reflection and strategy selection
---

# Reflection

The reflection system analyzes tool execution results to improve agent decision-making. After each tool call, the reflector evaluates the outcome and suggests adjustments.

## How It Works

```
Tool Execution → ToolReflection
                    ├── Classify error category
                    ├── Score confidence (0.0 - 1.0)
                    ├── Suggest retry strategy
                    └── Learn insights for future calls
```

## Error Categories

When a tool execution fails, the reflector classifies the error:

| Category | Description | Example |
|----------|-------------|---------|
| `Syntax` | Malformed arguments | Invalid JSON, wrong types |
| `NotFound` | Target doesn't exist | File not found, symbol missing |
| `Permission` | Access denied | Read-only file, blocked by policy |
| `Timeout` | Execution timed out | Long-running command |
| `Runtime` | Execution error | Command failed, crash |
| `Transient` | Temporary failure | Network error, rate limit |

## Confidence Scoring

Each reflection produces a confidence score (0.0 to 1.0) indicating how likely the next attempt will succeed:

| Score | Meaning | Agent Behavior |
|-------|---------|----------------|
| 0.8 - 1.0 | High confidence | Proceed with minor adjustments |
| 0.5 - 0.8 | Medium confidence | Try alternative approach |
| 0.0 - 0.5 | Low confidence | Ask user or change strategy |

## Retry Suggestions

The reflector suggests concrete alternatives when a tool call fails:

- **Syntax errors**: Corrected argument format
- **Not found**: Alternative paths or search suggestions
- **Permission denied**: Suggest asking user or using different tool
- **Timeout**: Suggest smaller scope or async execution
- **Transient**: Retry with backoff

## Agentic Strategy Integration

Reflection feeds into the agentic loop's strategy selection:

| Strategy | When Used |
|----------|-----------|
| `ITERATIVE` | Default — generate → tool → reflect → repeat |
| `PLANNED` | After repeated failures — create plan first |
| `DIRECT` | High confidence — single generation, no loop |
| `PARALLEL` | Independent tasks — parallel tool execution |

The `AUTO` strategy uses reflection history to dynamically switch between these modes.

## Streaming Events

Reflection events appear in the agentic streaming output:

```
event: reflection
data: {
  "tool": "Bash",
  "confidence": 0.3,
  "category": "Runtime",
  "suggestion": "The command failed. Try using 'find' instead of 'ls' for recursive search."
}
```
