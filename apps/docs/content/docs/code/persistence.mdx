---
title: Session Persistence
description: Pluggable session storage backends for conversation persistence
---

# Session Persistence

A3S Code supports pluggable session storage backends. Sessions can be stored in memory, on disk, or in a custom external store.

## Storage Types

| Type | Default | Description |
|------|---------|-------------|
| `memory` | | In-memory only, lost on restart |
| `file` | Yes | JSON files on disk |
| `custom` | | External store via `SessionStore` trait |

## Configuration

```hcl
storage_backend = "file"                 # "memory" | "file" | "custom"
sessions_dir    = "/tmp/a3s/sessions"    # file storage path
storage_url     = "redis://localhost:6379" # for custom backends
```

## File Storage

The default backend. Sessions are persisted as JSON files in the configured sessions directory.

```
~/.a3s/code/sessions/
├── <session-id-1>.json
├── <session-id-2>.json
└── ...
```

Sessions are automatically saved after each generation and restored across agent restarts.

## Custom Storage Backend (Rust)

For production deployments (PostgreSQL, Redis, S3, etc.), implement the `SessionStore` trait:

```rust
use a3s_code_core::store::SessionStore;

#[async_trait]
impl SessionStore for PostgresStore {
    async fn save(&self, id: &str, data: &SessionData) -> Result<()> {
        // Save to PostgreSQL
    }

    async fn load(&self, id: &str) -> Result<Option<SessionData>> {
        // Load from PostgreSQL
    }

    async fn delete(&self, id: &str) -> Result<()> {
        // Delete from PostgreSQL
    }

    async fn list(&self) -> Result<Vec<String>> {
        // List all session IDs
    }

    async fn exists(&self, id: &str) -> Result<bool> {
        // Check if session exists
    }
}
```

Pass the custom store via `CodeConfig`:

```rust
let mut config = CodeConfig::from_file("agent.hcl")?;
config.session_store = Some(Box::new(PostgresStore::new("postgresql://localhost/a3s").await?));
let agent = Agent::from_config(config).await?;
```
