---
title: Examples
description: Integration test examples for Rust, Python, and Node.js SDKs
---

# Examples

A3S Code provides comprehensive integration test examples for all three SDKs: Rust (core library), Python, and Node.js. These examples demonstrate real-world usage patterns and can be used as templates for your own applications.

## Overview

All examples use real LLM configuration from `~/.a3s/config.hcl` and test the same core features across all three SDKs:

- **Basic tool execution** - File operations, shell commands
- **Search operations** - Grep, glob pattern matching
- **Direct tool calls** - Bypass LLM for direct tool execution
- **Streaming execution** - Real-time event streaming
- **Queue configuration** - A3S Lane v0.4.0 advanced features
- **Conversation history** - Multi-turn conversations

## Rust Examples

Location: `crates/code/core/examples/`

### Integration Tests

**File:** `integration_tests.rs`

Complete feature test suite covering all major A3S Code features with 7 comprehensive tests.

```rust
use a3s_code_core::{Agent, SessionOptions};
use anyhow::Result;
use std::path::PathBuf;

#[tokio::main]
async fn main() -> Result<()> {
    // Initialize tracing
    tracing_subscriber::fmt()
        .with_env_filter("info,a3s_code_core=debug")
        .init();

    println!("ðŸš€ A3S Code Integration Tests\n");

    // Load config from ~/.a3s/config.hcl or fallback to local
    let config_path = dirs::home_dir()
        .map(|h| h.join(".a3s/config.hcl"))
        .filter(|p| p.exists())
        .or_else(|| {
            let project_root = PathBuf::from(env!("CARGO_MANIFEST_DIR"))
                .parent()
                .and_then(|p| p.parent())
                .and_then(|p| p.parent())
                .map(|p| p.join(".a3s/config.hcl"));
            project_root.filter(|p| p.exists())
        })
        .expect("Config file not found");

    println!("ðŸ“„ Using config: {}", config_path.display());

    let agent = Agent::new(config_path.to_str().unwrap()).await?;

    // Test 1: Basic Tool Execution
    test_basic_tools(&agent).await?;

    // Test 2: Built-in Skills
    test_builtin_skills(&agent).await?;

    // Test 3: File Operations
    test_file_operations(&agent).await?;

    // Test 4: Search Operations
    test_search_operations(&agent).await?;

    // Test 5: Web Search (if configured)
    test_web_search(&agent).await?;

    // Test 6: Planning Mode
    test_planning_mode(&agent).await?;

    // Test 7: Queue Configuration
    test_queue_config(&agent).await?;

    println!("\nâœ… All integration tests completed successfully!");

    Ok(())
}

async fn test_basic_tools(agent: &Agent) -> Result<()> {
    println!("\nðŸ“¦ Test 1: Basic Tool Execution");
    let session = agent.session(".", None)?;

    println!("Testing: List current directory...");
    let result = session.send("List the files in the current directory using ls", None).await?;
    println!("âœ“ Result preview: {}", truncate(&result.text, 200));

    println!("\nTesting: Read a file...");
    let result = session.send("Read the Cargo.toml file", None).await?;
    println!("âœ“ Result preview: {}", truncate(&result.text, 200));

    println!("\nâœ… Test 1 passed");
    Ok(())
}

async fn test_builtin_skills(agent: &Agent) -> Result<()> {
    println!("\nðŸ§  Test 2: Built-in Skills (7 skills)");

    let session = agent.session(".", Some(
        SessionOptions::new().with_builtin_skills()
    ))?;

    println!("Testing: code-search skill...");
    let result = session.send("Search for all functions named 'new' in Rust files", None).await?;
    println!("âœ“ Result preview: {}", truncate(&result.text, 200));

    println!("\nâœ… Test 2 passed");
    Ok(())
}

async fn test_file_operations(agent: &Agent) -> Result<()> {
    println!("\nðŸ“ Test 3: File Operations");
    let session = agent.session(".", None)?;

    println!("Testing: Create a test file...");
    let result = session.send(
        "Create a file named 'test_integration.txt' with content 'Hello from A3S Code!'",
        None
    ).await?;
    println!("âœ“ Result: {}", truncate(&result.text, 200));

    println!("\nCleaning up...");
    let _ = std::fs::remove_file("test_integration.txt");

    println!("\nâœ… Test 3 passed");
    Ok(())
}

async fn test_search_operations(agent: &Agent) -> Result<()> {
    println!("\nðŸ” Test 4: Search Operations");
    let session = agent.session(".", None)?;

    println!("Testing: grep search...");
    let result = session.send("Search for 'Agent' in all Rust files using grep", None).await?;
    println!("âœ“ Result preview: {}", truncate(&result.text, 200));

    println!("\nâœ… Test 4 passed");
    Ok(())
}

async fn test_web_search(agent: &Agent) -> Result<()> {
    println!("\nðŸŒ Test 5: Web Search");
    let session = agent.session(".", None)?;

    let result = session.send(
        "Search the web for 'Rust async programming' and summarize",
        None
    ).await;

    match result {
        Ok(r) => println!("âœ“ Result preview: {}", truncate(&r.text, 300)),
        Err(e) => println!("âš ï¸  Web search not available: {}", e),
    }

    Ok(())
}

async fn test_planning_mode(agent: &Agent) -> Result<()> {
    println!("\nðŸŽ¯ Test 6: Planning Mode");

    let session = agent.session(".", Some(
        SessionOptions::new()
            .with_planning(true)
            .with_goal_tracking(true)
    ))?;

    println!("Testing: Multi-step task with planning...");
    let result = session.send(
        "Create a file named 'plan_test.txt', write 'Step 1' to it, then read it back",
        None
    ).await?;
    println!("âœ“ Result preview: {}", truncate(&result.text, 300));

    let _ = std::fs::remove_file("plan_test.txt");
    println!("\nâœ… Test 6 passed");
    Ok(())
}

async fn test_queue_config(agent: &Agent) -> Result<()> {
    println!("\nâš¡ Test 7: Queue Configuration (A3S Lane v0.4.0)");

    use a3s_code_core::queue::{SessionQueueConfig, RetryPolicyConfig};

    let queue_config = SessionQueueConfig {
        query_max_concurrency: 5,
        execute_max_concurrency: 2,
        enable_metrics: true,
        enable_dlq: true,
        retry_policy: Some(RetryPolicyConfig {
            strategy: "exponential".to_string(),
            max_retries: 3,
            initial_delay_ms: 100,
            fixed_delay_ms: None,
        }),
        ..Default::default()
    };

    let session = agent.session(".", Some(
        SessionOptions::new().with_queue_config(queue_config)
    ))?;

    println!("Testing: Parallel query operations with queue...");
    let result = session.send(
        "List all .rs files and count how many contain 'async'",
        None
    ).await?;
    println!("âœ“ Result preview: {}", truncate(&result.text, 200));

    println!("\nâœ… Test 7 passed");
    Ok(())
}

fn truncate(s: &str, max_len: usize) -> String {
    if s.len() <= max_len {
        s.to_string()
    } else {
        format!("{}... (truncated)", &s[..max_len])
    }
}
```

**Run:**
```bash
cd crates/code/core
cargo run --example integration_tests
```

**Expected Output:**
```
ðŸš€ A3S Code Integration Tests

ðŸ“„ Using config: /Users/you/.a3s/config.hcl

ðŸ“¦ Test 1: Basic Tool Execution
Testing: List current directory...
âœ“ Result preview: Here are the files in the current directory:...
âœ“ Test 1 passed

ðŸ§  Test 2: Built-in Skills (7 skills)
Testing: code-search skill...
âœ“ Result preview: Found 15 functions named 'new' in Rust files...
âœ“ Test 2 passed

ðŸ“ Test 3: File Operations
Testing: Create a test file...
âœ“ Result: File created successfully...
âœ“ Test 3 passed

ðŸ” Test 4: Search Operations
Testing: grep search...
âœ“ Result preview: Found 42 matches for 'Agent' in 8 files...
âœ“ Test 4 passed

ðŸŒ Test 5: Web Search
âœ“ Result preview: Based on web search results, Rust async programming...

ðŸŽ¯ Test 6: Planning Mode
Testing: Multi-step task with planning...
âœ“ Result preview: I'll complete this task in 3 steps...
âœ“ Test 6 passed

âš¡ Test 7: Queue Configuration (A3S Lane v0.4.0)
Testing: Parallel query operations with queue...
âœ“ Result preview: Found 127 .rs files, 89 contain 'async'...
âœ“ Test 7 passed

âœ… All integration tests completed successfully!
```

### Lane Features Test

**File:** `test_lane_features.rs`

Tests A3S Lane v0.4.0 advanced queue features.

```rust
use a3s_code_core::queue::{SessionQueueConfig, RetryPolicyConfig};

let queue_config = SessionQueueConfig {
    query_max_concurrency: 5,
    execute_max_concurrency: 2,
    enable_metrics: true,
    enable_dlq: true,
    retry_policy: Some(RetryPolicyConfig {
        strategy: "exponential".to_string(),
        max_retries: 3,
        initial_delay_ms: 100,
        fixed_delay_ms: None,
    }),
    ..Default::default()
};

let session = agent.session(".", Some(
    SessionOptions::new().with_queue_config(queue_config)
))?;
```

**Run:**
```bash
cargo run --example test_lane_features
```

### Search Configuration Test

**File:** `test_search_config.rs`

Tests A3S Search v0.7.0 configurable web search.

```rust
let config_hcl = r#"
    default_model = "openai/gpt-4o"

    providers { ... }

    search {
        timeout = 30

        engine {
            ddg {
                enabled = true
                weight = 1.5
            }
            wiki {
                enabled = true
                weight = 1.2
            }
        }
    }
"#;

let agent = Agent::new(config_hcl).await?;
```

**Run:**
```bash
cargo run --example test_search_config
```

### Built-in Skills Test

**File:** `test_builtin_skills.rs`

Tests all 7 built-in skills individually.

```rust
let session = agent.session(".", Some(
    SessionOptions::new().with_builtin_skills()
))?;

// Test code-search skill
let result = session.send(
    "Search for all functions named 'new' in Rust files",
    None
).await?;
```

**Run:**
```bash
cargo run --example test_builtin_skills
```

## Python Examples

Location: `crates/code/sdk/python/examples/`

### Integration Tests

**File:** `integration_tests.py`

Complete Python SDK test suite with 8 comprehensive tests.

```python
#!/usr/bin/env python3
"""
A3S Code Python SDK - Integration Tests

Tests all major features using real LLM configuration from ~/.a3s/config.hcl

Run with: python examples/integration_tests.py
"""

import asyncio
import os
from pathlib import Path
from a3s_code import Agent, SessionQueueConfig, builtin_skills


def find_config_path():
    """Find config file in home directory or project root."""
    home_config = Path.home() / ".a3s" / "config.hcl"
    if home_config.exists():
        return str(home_config)

    # Try project root
    project_config = Path(__file__).parent.parent.parent.parent.parent.parent / ".a3s" / "config.hcl"
    if project_config.exists():
        return str(project_config)

    raise FileNotFoundError("Config file not found. Please create ~/.a3s/config.hcl")


def truncate(text, max_len):
    """Truncate text to max length."""
    if len(text) <= max_len:
        return text
    return f"{text[:max_len]}... (truncated)"


async def test_basic_tools(agent):
    """Test 1: Basic tool execution."""
    print("\nðŸ“¦ Test 1: Basic Tool Execution")
    print("-" * 80)

    session = agent.session(".")

    print("Testing: List current directory...")
    result = session.send("List the files in the current directory using ls")
    print(f"âœ“ Result preview: {truncate(result.text, 200)}")

    print("\nTesting: Read a file...")
    result = session.send("Read the Cargo.toml file")
    print(f"âœ“ Result preview: {truncate(result.text, 200)}")

    print("\nâœ… Test 1 passed: Basic tools work correctly")


async def test_builtin_skills(agent):
    """Test 2: Built-in skills."""
    print("\nðŸ§  Test 2: Built-in Skills (7 skills)")
    print("-" * 80)

    # List available skills
    skills = builtin_skills()
    print(f"Available skills: {len(skills)}")
    for skill in skills[:3]:  # Show first 3
        print(f"  - {skill.name} ({skill.kind}): {truncate(skill.description, 60)}")

    # Create session with builtin skills enabled
    session = agent.session(".", builtin_skills=True)

    print("\nTesting: code-search skill...")
    result = session.send("Search for all functions named 'new' in Rust files")
    print(f"âœ“ Result preview: {truncate(result.text, 200)}")

    print("\nTesting: builtin-tools skill...")
    result = session.send("What tools are available for file operations?")
    print(f"âœ“ Result preview: {truncate(result.text, 200)}")

    print("\nâœ… Test 2 passed: Built-in skills work correctly")


async def test_file_operations(agent):
    """Test 3: File operations."""
    print("\nðŸ“ Test 3: File Operations")
    print("-" * 80)

    session = agent.session(".")

    print("Testing: Create a test file...")
    result = session.send(
        "Create a file named 'test_integration_py.txt' with content 'Hello from Python SDK!'"
    )
    print(f"âœ“ Result: {truncate(result.text, 200)}")

    print("\nTesting: Read the test file...")
    result = session.send("Read the file test_integration_py.txt")
    print(f"âœ“ Result: {truncate(result.text, 200)}")

    print("\nCleaning up: Remove test file...")
    try:
        os.remove("test_integration_py.txt")
    except FileNotFoundError:
        pass

    print("\nâœ… Test 3 passed: File operations work correctly")


async def test_search_operations(agent):
    """Test 4: Search operations."""
    print("\nðŸ” Test 4: Search Operations")
    print("-" * 80)

    session = agent.session(".")

    print("Testing: grep search...")
    result = session.send("Search for the word 'Agent' in all Rust files using grep")
    print(f"âœ“ Result preview: {truncate(result.text, 200)}")

    print("\nTesting: glob pattern matching...")
    result = session.send("Find all .rs files in the src directory using glob")
    print(f"âœ“ Result preview: {truncate(result.text, 200)}")

    print("\nâœ… Test 4 passed: Search operations work correctly")


async def test_direct_tool_calls(agent):
    """Test 5: Direct tool execution."""
    print("\nðŸ› ï¸  Test 5: Direct Tool Execution")
    print("-" * 80)

    session = agent.session(".")

    print("Testing: Direct read_file call...")
    content = session.read_file("Cargo.toml")
    print(f"âœ“ Read {len(content)} bytes from Cargo.toml")

    print("\nTesting: Direct bash call...")
    output = session.bash("echo 'Hello from Python SDK'")
    print(f"âœ“ Bash output: {output.strip()}")

    print("\nTesting: Direct glob call...")
    files = session.glob("src/*.rs")
    print(f"âœ“ Found {len(files)} Rust files")

    print("\nTesting: Direct grep call...")
    matches = session.grep("Agent")
    print(f"âœ“ Grep found {len(matches)} bytes of matches")

    print("\nâœ… Test 5 passed: Direct tool calls work correctly")


async def test_streaming(agent):
    """Test 6: Streaming execution."""
    print("\nðŸŒŠ Test 6: Streaming Execution")
    print("-" * 80)

    session = agent.session(".")

    print("Testing: Stream events...")
    event_count = 0
    text_deltas = 0
    tool_calls = 0

    for event in session.stream("List all .rs files in the current directory"):
        event_count += 1
        if event.event_type == "text_delta":
            text_deltas += 1
        elif event.event_type == "tool_start":
            tool_calls += 1
            print(f"  Tool called: {event.tool_name}")

    print(f"âœ“ Received {event_count} events ({text_deltas} text deltas, {tool_calls} tool calls)")
    print("\nâœ… Test 6 passed: Streaming works correctly")


async def test_queue_config(agent):
    """Test 7: Queue configuration."""
    print("\nâš¡ Test 7: Queue Configuration (A3S Lane v0.4.0)")
    print("-" * 80)

    queue_config = SessionQueueConfig()
    queue_config.set_query_concurrency(5)
    queue_config.set_execute_concurrency(2)
    queue_config.enable_dlq()
    queue_config.enable_metrics()

    session = agent.session(".", queue_config=queue_config)

    print("Testing: Parallel query operations with queue...")
    result = session.send("List all .rs files and count how many contain the word 'async'")
    print(f"âœ“ Result preview: {truncate(result.text, 200)}")

    if session.has_queue():
        stats = session.queue_stats()
        print(f"âœ“ Queue stats: {stats}")

    print("\nâœ… Test 7 passed: Queue configuration works correctly")


async def test_conversation_history(agent):
    """Test 8: Conversation history."""
    print("\nðŸ’¬ Test 8: Conversation History")
    print("-" * 80)

    session = agent.session(".")

    print("Testing: Multi-turn conversation...")
    result1 = session.send("What is 2 + 2?")
    print(f"âœ“ Turn 1: {truncate(result1.text, 100)}")

    result2 = session.send("What was my previous question?")
    print(f"âœ“ Turn 2: {truncate(result2.text, 100)}")

    history = session.history()
    print(f"âœ“ History has {len(history)} messages")

    print("\nâœ… Test 8 passed: Conversation history works correctly")


async def main():
    """Run all integration tests."""
    print("ðŸš€ A3S Code Python SDK - Integration Tests\n")
    print("=" * 80)

    # Load config
    config_path = find_config_path()
    print(f"ðŸ“„ Using config: {config_path}")
    print("=" * 80)
    print()

    # Create agent
    agent = Agent.create(config_path)

    # Run tests
    await test_basic_tools(agent)
    await test_builtin_skills(agent)
    await test_file_operations(agent)
    await test_search_operations(agent)
    await test_direct_tool_calls(agent)
    await test_streaming(agent)
    await test_queue_config(agent)
    await test_conversation_history(agent)

    print("\n" * 2)
    print("=" * 80)
    print("âœ… All Python SDK integration tests completed successfully!")
    print("=" * 80)


if __name__ == "__main__":
    asyncio.run(main())
```

**Run:**
```bash
cd crates/code/sdk/python
pip install -e .
python examples/integration_tests.py
```

**Expected Output:**
```
ðŸš€ A3S Code Python SDK - Integration Tests

ðŸ“„ Using config: /Users/you/.a3s/config.hcl

ðŸ“¦ Test 1: Basic Tool Execution
Testing: List current directory...
âœ“ Result preview: Here are the files...
âœ… Test 1 passed

ðŸ§  Test 2: Built-in Skills (7 skills)
Available skills: 7
  - code-search (skill): Search codebase for patterns, functions...
  - code-review (skill): Review code for best practices...
  - explain-code (skill): Explain how code works...
âœ… Test 2 passed

ðŸ“ Test 3: File Operations
âœ… Test 3 passed

ðŸ” Test 4: Search Operations
âœ… Test 4 passed

ðŸ› ï¸  Test 5: Direct Tool Execution
âœ“ Read 653 bytes from Cargo.toml
âœ“ Bash output: Hello from Python SDK
âœ“ Found 42 Rust files
âœ“ Grep found 15234 bytes of matches
âœ… Test 5 passed

ðŸŒŠ Test 6: Streaming Execution
  Tool called: glob
âœ“ Received 127 events (89 text deltas, 3 tool calls)
âœ… Test 6 passed

âš¡ Test 7: Queue Configuration (A3S Lane v0.4.0)
âœ“ Queue stats: {'pending': 0, 'completed': 5}
âœ… Test 7 passed

ðŸ’¬ Test 8: Conversation History
âœ“ Turn 1: The answer is 4...
âœ“ Turn 2: You asked "What is 2 + 2?"...
âœ“ History has 4 messages
âœ… Test 8 passed

âœ… All Python SDK integration tests completed successfully!
```

### Built-in Skills

```python
from a3s_code import Agent, builtin_skills

# List available skills
skills = builtin_skills()
print(f"Available skills: {len(skills)}")
for skill in skills:
    print(f"  - {skill.name} ({skill.kind}): {skill.description}")

# Create session with builtin skills enabled
agent = Agent.create("~/.a3s/config.hcl")
session = agent.session(".", builtin_skills=True)

# Use code-search skill
result = session.send("Search for all functions named 'new' in Rust files")
print(result.text)

# Use builtin-tools skill
result = session.send("What tools are available for file operations?")
print(result.text)
```

**Available Skills:**
- **code-search** - Search codebase for patterns, functions, or types
- **code-review** - Review code for best practices and improvements
- **explain-code** - Explain how code works in clear terms
- **find-bugs** - Identify potential bugs and vulnerabilities
- **builtin-tools** - Documentation for built-in tools
- **delegate-task** - Guide for delegating tasks to sub-agents
- **find-skills** - Discover and install agent skills

### Queue Configuration

```python
# Configure A3S Lane queue
queue_config = SessionQueueConfig()
queue_config.set_query_concurrency(5)
queue_config.set_execute_concurrency(2)
queue_config.enable_dlq()
queue_config.enable_metrics()

session = agent.session(".", queue_config=queue_config)

# Check queue status
if session.has_queue():
    stats = session.queue_stats()
    print(f"Queue stats: {stats}")
```

### Web Search Configuration

**File:** `test_search_config.py`

Configure A3S Search v0.7.0 engines via HCL and test with real LLM.

```python
from a3s_code import Agent

# Create agent with inline HCL config including search configuration
config_hcl = """
    default_model = "openai/gpt-4o"

    providers {
      name = "openai"
      models {
        id = "gpt-4o"
        # ... model config ...
      }
    }

    # Custom search configuration
    search {
      timeout = 30

      health {
        max_failures = 3
        suspend_seconds = 60
      }

      engine {
        ddg {
          enabled = true
          weight = 1.5
        }

        wiki {
          enabled = true
          weight = 1.2
        }

        brave {
          enabled = true
          weight = 1.0
          timeout = 20
        }
      }
    }
"""

# Create agent and session with search config
agent = Agent.create(config_hcl)
session = agent.session(".")

# Test web search with custom configuration
result = session.send("Search for 'Rust tokio tutorial' and summarize the findings")
print(result.text)
```

**Run:**
```bash
python examples/test_search_config.py
```

### Conversation History

```python
# Multi-turn conversation
session = agent.session(".")

result1 = session.send("What is 2 + 2?")
result2 = session.send("What was my previous question?")

# Access history
history = session.history()
print(f"History has {len(history)} messages")
```

## Node.js Examples

Location: `crates/code/sdk/node/examples/`

### Integration Tests

**File:** `integration_tests.js`

Complete Node.js SDK test suite with 8 comprehensive tests.

```javascript
#!/usr/bin/env node
/**
 * A3S Code Node.js SDK - Integration Tests
 *
 * Tests all major features using real LLM configuration from ~/.a3s/config.hcl
 *
 * Run with: node examples/integration_tests.js
 */

const { Agent, builtinSkills } = require('../index.js');
const fs = require('fs');
const path = require('path');
const os = require('os');

/**
 * Find config file in home directory or project root.
 */
function findConfigPath() {
  const homeConfig = path.join(os.homedir(), '.a3s', 'config.hcl');
  if (fs.existsSync(homeConfig)) {
    return homeConfig;
  }

  // Try project root
  const projectConfig = path.join(__dirname, '..', '..', '..', '..', '..', '..', '.a3s', 'config.hcl');
  if (fs.existsSync(projectConfig)) {
    return projectConfig;
  }

  throw new Error('Config file not found. Please create ~/.a3s/config.hcl');
}

/**
 * Truncate text to max length.
 */
function truncate(text, maxLen) {
  if (text.length <= maxLen) {
    return text;
  }
  return `${text.substring(0, maxLen)}... (truncated)`;
}

/**
 * Test 1: Basic tool execution.
 */
async function testBasicTools(agent) {
  console.log('\nðŸ“¦ Test 1: Basic Tool Execution');
  console.log('-'.repeat(80));

  const session = agent.session('.');

  console.log('Testing: List current directory...');
  const result1 = await session.send('List the files in the current directory using ls');
  console.log(`âœ“ Result preview: ${truncate(result1.text, 200)}`);

  console.log('\nTesting: Read a file...');
  const result2 = await session.send('Read the Cargo.toml file');
  console.log(`âœ“ Result preview: ${truncate(result2.text, 200)}`);

  console.log('\nâœ… Test 1 passed: Basic tools work correctly');
}

/**
 * Test 2: Built-in skills.
 */
async function testBuiltinSkills(agent) {
  console.log('\nðŸ§  Test 2: Built-in Skills (7 skills)');
  console.log('-'.repeat(80));

  // List available skills
  const skills = builtinSkills();
  console.log(`Available skills: ${skills.length}`);
  for (let i = 0; i < Math.min(3, skills.length); i++) {
    const skill = skills[i];
    console.log(`  - ${skill.name} (${skill.kind}): ${truncate(skill.description, 60)}`);
  }

  // Create session with builtin skills enabled
  const session = agent.session('.', { builtinSkills: true });

  console.log('\nTesting: code-search skill...');
  const result1 = await session.send('Search for all functions named "new" in Rust files');
  console.log(`âœ“ Result preview: ${truncate(result1.text, 200)}`);

  console.log('\nTesting: builtin-tools skill...');
  const result2 = await session.send('What tools are available for file operations?');
  console.log(`âœ“ Result preview: ${truncate(result2.text, 200)}`);

  console.log('\nâœ… Test 2 passed: Built-in skills work correctly');
}

/**
 * Test 3: File operations.
 */
async function testFileOperations(agent) {
  console.log('\nðŸ“ Test 3: File Operations');
  console.log('-'.repeat(80));

  const session = agent.session('.');

  console.log('Testing: Create a test file...');
  const result1 = await session.send(
    "Create a file named 'test_integration_js.txt' with content 'Hello from Node.js SDK!'"
  );
  console.log(`âœ“ Result: ${truncate(result1.text, 200)}`);

  console.log('\nTesting: Read the test file...');
  const result2 = await session.send('Read the file test_integration_js.txt');
  console.log(`âœ“ Result: ${truncate(result2.text, 200)}`);

  console.log('\nCleaning up: Remove test file...');
  try {
    fs.unlinkSync('test_integration_js.txt');
  } catch (err) {
    // Ignore if file doesn't exist
  }

  console.log('\nâœ… Test 3 passed: File operations work correctly');
}

/**
 * Test 4: Search operations.
 */
async function testSearchOperations(agent) {
  console.log('\nðŸ” Test 4: Search Operations');
  console.log('-'.repeat(80));

  const session = agent.session('.');

  console.log('Testing: grep search...');
  const result1 = await session.send('Search for the word "Agent" in all Rust files using grep');
  console.log(`âœ“ Result preview: ${truncate(result1.text, 200)}`);

  console.log('\nTesting: glob pattern matching...');
  const result2 = await session.send('Find all .rs files in the src directory using glob');
  console.log(`âœ“ Result preview: ${truncate(result2.text, 200)}`);

  console.log('\nâœ… Test 4 passed: Search operations work correctly');
}

/**
 * Test 5: Direct tool execution.
 */
async function testDirectToolCalls(agent) {
  console.log('\nðŸ› ï¸  Test 5: Direct Tool Execution');
  console.log('-'.repeat(80));

  const session = agent.session('.');

  console.log('Testing: Direct readFile call...');
  const content = await session.readFile('Cargo.toml');
  console.log(`âœ“ Read ${content.length} bytes from Cargo.toml`);

  console.log('\nTesting: Direct bash call...');
  const output = await session.bash("echo 'Hello from Node.js SDK'");
  console.log(`âœ“ Bash output: ${output.trim()}`);

  console.log('\nTesting: Direct glob call...');
  const files = await session.glob('src/*.rs');
  console.log(`âœ“ Found ${files.length} Rust files`);

  console.log('\nTesting: Direct grep call...');
  const matches = await session.grep('Agent');
  console.log(`âœ“ Grep found ${matches.length} bytes of matches`);

  console.log('\nâœ… Test 5 passed: Direct tool calls work correctly');
}

/**
 * Test 6: Streaming execution.
 */
async function testStreaming(agent) {
  console.log('\nðŸŒŠ Test 6: Streaming Execution');
  console.log('-'.repeat(80));

  const session = agent.session('.');

  console.log('Testing: Stream events...');
  const events = await session.stream('List all .rs files in the current directory');

  let textDeltas = 0;
  let toolCalls = 0;

  for (const event of events) {
    if (event.type === 'text_delta') {
      textDeltas++;
    } else if (event.type === 'tool_start') {
      toolCalls++;
      console.log(`  Tool called: ${event.toolName}`);
    }
  }

  console.log(`âœ“ Received ${events.length} events (${textDeltas} text deltas, ${toolCalls} tool calls)`);
  console.log('\nâœ… Test 6 passed: Streaming works correctly');
}

/**
 * Test 7: Queue configuration.
 */
async function testQueueConfig(agent) {
  console.log('\nâš¡ Test 7: Queue Configuration (A3S Lane v0.4.0)');
  console.log('-'.repeat(80));

  console.log('Testing: Session with queue configuration...');
  const session = agent.session('.', {
    queueConfig: {
      queryConcurrency: 5,
      executeConcurrency: 2,
      enableDlq: true,
      enableMetrics: true,
      enableAllFeatures: false
    }
  });

  const result = await session.send('List all .rs files and count how many contain the word "async"');
  console.log(`âœ“ Result preview: ${truncate(result.text, 200)}`);

  console.log('\nâœ… Test 7 passed: Queue configuration works correctly');
}

/**
 * Test 8: Conversation history.
 */
async function testConversationHistory(agent) {
  console.log('\nðŸ’¬ Test 8: Conversation History');
  console.log('-'.repeat(80));

  const session = agent.session('.');

  console.log('Testing: Multi-turn conversation...');
  const result1 = await session.send('What is 2 + 2?');
  console.log(`âœ“ Turn 1: ${truncate(result1.text, 100)}`);

  const result2 = await session.send('What was my previous question?');
  console.log(`âœ“ Turn 2: ${truncate(result2.text, 100)}`);

  const history = session.history();
  console.log(`âœ“ History has ${history.length} messages`);

  console.log('\nâœ… Test 8 passed: Conversation history works correctly');
}

/**
 * Main test runner.
 */
async function main() {
  console.log('ðŸš€ A3S Code Node.js SDK - Integration Tests\n');
  console.log('='.repeat(80));

  // Load config
  const configPath = findConfigPath();
  console.log(`ðŸ“„ Using config: ${configPath}`);
  console.log('='.repeat(80));
  console.log();

  // Create agent
  const agent = await Agent.create(configPath);

  // Run tests
  await testBasicTools(agent);
  await testBuiltinSkills(agent);
  await testFileOperations(agent);
  await testSearchOperations(agent);
  await testDirectToolCalls(agent);
  await testStreaming(agent);
  await testQueueConfig(agent);
  await testConversationHistory(agent);

  console.log('\n\n');
  console.log('='.repeat(80));
  console.log('âœ… All Node.js SDK integration tests completed successfully!');
  console.log('='.repeat(80));
}

// Run tests
main().catch((err) => {
  console.error('âŒ Test failed:', err);
  process.exit(1);
});
```

**Run:**
```bash
cd crates/code/sdk/node
npm install
npm run build
node examples/integration_tests.js
```

**Expected Output:**
```
ðŸš€ A3S Code Node.js SDK - Integration Tests

ðŸ“„ Using config: /Users/you/.a3s/config.hcl

ðŸ“¦ Test 1: Basic Tool Execution
Testing: List current directory...
âœ“ Result preview: Here are the files...
âœ… Test 1 passed

ðŸ§  Test 2: Built-in Skills (7 skills)
Available skills: 7
  - code-search (skill): Search codebase for patterns...
  - code-review (skill): Review code for best practices...
  - explain-code (skill): Explain how code works...
âœ… Test 2 passed

ðŸ“ Test 3: File Operations
âœ… Test 3 passed

ðŸ” Test 4: Search Operations
âœ… Test 4 passed

ðŸ› ï¸  Test 5: Direct Tool Execution
âœ“ Read 653 bytes from Cargo.toml
âœ“ Bash output: Hello from Node.js SDK
âœ“ Found 42 Rust files
âœ“ Grep found 15234 bytes of matches
âœ… Test 5 passed

ðŸŒŠ Test 6: Streaming Execution
  Tool called: glob
âœ“ Received 127 events (89 text deltas, 3 tool calls)
âœ… Test 6 passed

âš¡ Test 7: Queue Configuration (A3S Lane v0.4.0)
âœ… Test 7 passed

ðŸ’¬ Test 8: Conversation History
âœ“ Turn 1: The answer is 4...
âœ“ Turn 2: You asked "What is 2 + 2?"...
âœ“ History has 4 messages
âœ… Test 8 passed

âœ… All Node.js SDK integration tests completed successfully!
```

### Built-in Skills

```javascript
const { Agent, builtinSkills } = require('@a3s/code');

// List available skills
const skills = builtinSkills();
console.log(`Available skills: ${skills.length}`);
skills.forEach(skill => {
  console.log(`  - ${skill.name} (${skill.kind}): ${skill.description}`);
});

// Create session with builtin skills enabled
const agent = await Agent.create('~/.a3s/config.hcl');
const session = agent.session('.', { builtinSkills: true });

// Use code-search skill
const result1 = await session.send('Search for all functions named "new" in Rust files');
console.log(result1.text);

// Use builtin-tools skill
const result2 = await session.send('What tools are available for file operations?');
console.log(result2.text);
```

**Available Skills:**
- **code-search** - Search codebase for patterns, functions, or types
- **code-review** - Review code for best practices and improvements
- **explain-code** - Explain how code works in clear terms
- **find-bugs** - Identify potential bugs and vulnerabilities
- **builtin-tools** - Documentation for built-in tools
- **delegate-task** - Guide for delegating tasks to sub-agents
- **find-skills** - Discover and install agent skills

### Queue Configuration

```javascript
// Create session with queue configuration
const session = agent.session('.', {
  queueConfig: {
    queryConcurrency: 5,
    executeConcurrency: 2,
    enableDlq: true,
    enableMetrics: true,
    enableAllFeatures: false
  }
});

const result = await session.send('List all .rs files and count how many contain "async"');
console.log(result.text);
```

### Web Search Configuration

**File:** `test_search_config.js`

Configure A3S Search v0.7.0 engines via HCL and test with real LLM.

```javascript
const { Agent } = require('@a3s/code');

// Create agent with inline HCL config including search configuration
const configHcl = `
  default_model = "openai/gpt-4o"

  providers {
    name = "openai"
    models {
      id = "gpt-4o"
      # ... model config ...
    }
  }

  # Custom search configuration
  search {
    timeout = 30

    health {
      max_failures = 3
      suspend_seconds = 60
    }

    engine {
      ddg {
        enabled = true
        weight = 1.5
      }

      wiki {
        enabled = true
        weight = 1.2
      }

      brave {
        enabled = true
        weight = 1.0
        timeout = 20
      }
    }
  }
`;

// Create agent and session with search config
const agent = await Agent.create(configHcl);
const session = agent.session('.');

// Test web search with custom configuration
const result = await session.send("Search for 'Rust tokio tutorial' and summarize the findings");
console.log(result.text);
```

**Run:**
```bash
node examples/test_search_config.js
```

### Session Options

```javascript
// Create session with custom options
const session = agent.session('.', {
  model: 'openai/gpt-4o',      // Override default model
  builtinSkills: true,         // Enable built-in skills
  skillDirs: ['./skills'],     // Custom skill directories
  agentDirs: ['./agents'],     // Custom agent directories
  queueConfig: { /* ... */ }   // Queue configuration
});
```

### TypeScript Support

```typescript
import { Agent, AgentResult, SessionOptions } from '@a3s/code';

async function main() {
  const agent = await Agent.create('~/.a3s/config.hcl');

  const options: SessionOptions = {
    model: 'openai/gpt-4o',
    builtinSkills: true
  };

  const session = agent.session('.', options);
  const result: AgentResult = await session.send('Hello!');

  console.log(`Response: ${result.text}`);
  console.log(`Tokens: ${result.totalTokens}`);
  console.log(`Tool calls: ${result.toolCallsCount}`);
}
```

## Configuration

All examples require a configuration file at `~/.a3s/config.hcl`:

```hcl
default_model = "openai/gpt-4o"

providers {
  name = "openai"

  models {
    id          = "gpt-4o"
    name        = "GPT-4o"
    family      = "gpt"
    api_key     = "your-api-key-here"
    base_url    = "https://api.openai.com/v1"
    attachment  = false
    reasoning   = false
    tool_call   = true
    temperature = true

    modalities {
      input  = ["text"]
      output = ["text"]
    }

    limit {
      context = 128000
      output  = 4096
    }
  }
}

# Optional: Configure web search
search {
  timeout = 30

  engine {
    ddg {
      enabled = true
      weight = 1.5
    }
    wiki {
      enabled = true
      weight = 1.2
    }
  }
}
```

## Running All Tests

### Rust

```bash
cd crates/code/core
cargo run --example integration_tests
cargo run --example test_lane_features
cargo run --example test_search_config
cargo run --example test_builtin_skills
```

### Python

```bash
cd crates/code/sdk/python
pip install -e .
python examples/integration_tests.py
```

### Node.js

```bash
cd crates/code/sdk/node
npm install && npm run build
node examples/integration_tests.js
```

## Test Coverage

| Feature | Rust | Python | Node.js |
|---------|------|--------|---------|
| Basic tools | âœ… | âœ… | âœ… |
| Built-in skills | âœ… | âœ… | âœ… |
| File operations | âœ… | âœ… | âœ… |
| Search operations | âœ… | âœ… | âœ… |
| Direct tool calls | âœ… | âœ… | âœ… |
| Streaming | âœ… | âœ… | âœ… |
| Queue config | âœ… | âœ… | âœ… |
| Web search config | âœ… | âœ… | âœ… |
| Conversation history | âœ… | âœ… | âœ… |

**All features now fully covered across all three SDKs!**

## SDK Installation

### Python SDK

**Install from PyPI:**
```bash
pip install a3s-code
```

**Install from source:**
```bash
cd crates/code/sdk/python
pip install -e .
```

**Verify installation:**
```bash
python -c "from a3s_code import Agent; print('A3S Code Python SDK installed successfully')"
```

### Node.js SDK

**Install from npm:**
```bash
npm install @a3s/code
```

**Install from source:**
```bash
cd crates/code/sdk/node
npm install
npm run build
```

**Verify installation:**
```bash
node -e "const { Agent } = require('@a3s/code'); console.log('A3S Code Node.js SDK installed successfully')"
```

### TypeScript Support

The Node.js SDK includes TypeScript definitions. For TypeScript projects:

```typescript
import { Agent, AgentResult, SessionOptions } from '@a3s/code';

async function main() {
  const agent = await Agent.create('~/.a3s/config.hcl');

  const options: SessionOptions = {
    model: 'openai/gpt-4o',
    builtinSkills: true
  };

  const session = agent.session('.', options);
  const result: AgentResult = await session.send('Hello!');

  console.log(`Response: ${result.text}`);
  console.log(`Tokens: ${result.totalTokens}`);
  console.log(`Tool calls: ${result.toolCallsCount}`);
}

main();
```

## Troubleshooting

### Config file not found

**Error:**
```
Config file not found. Please create ~/.a3s/config.hcl
```

**Solution:**
Create `~/.a3s/config.hcl` with your LLM configuration.

### API key errors

**Error:**
```
Failed to authenticate with LLM provider
```

**Solution:**
1. Check your API key in `config.hcl`
2. Ensure the API key is valid and has sufficient credits
3. Verify the `base_url` is correct

### Build errors (Rust)

**Error:**
```
error: could not compile `a3s-code-core`
```

**Solution:**
```bash
cargo clean
cargo build --examples
```

### Import errors (Python)

**Error:**
```
ModuleNotFoundError: No module named 'a3s_code'
```

**Solution:**
```bash
pip install -e .
```

### Module not found (Node.js)

**Error:**
```
Error: Cannot find module '@a3s/code'
```

**Solution:**
```bash
npm run build
```

## Next Steps

- [Sessions](/docs/code/sessions) - Learn about session management
- [Tools](/docs/code/tools) - Explore available tools
- [Skills](/docs/code/skills) - Understand the skill system
- [Lane Queue](/docs/code/lane-queue) - Configure advanced queue features
