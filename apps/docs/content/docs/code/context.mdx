---
title: Context Management
description: Monitor, compact, and clear conversation context
---

# Context Management

Each session maintains a conversation context with a token budget. When the context grows too large, it can be compacted (summarized) or cleared entirely.

## Get Context Usage

Check current token consumption for a session.

```typescript
const { usage } = await client.getContextUsage(sessionId);
console.log(`Total: ${usage.totalTokens} tokens`);
console.log(`Prompt: ${usage.promptTokens}, Completion: ${usage.completionTokens}`);
console.log(`Messages: ${usage.messageCount}`);
```

```python
result = await client.get_context_usage(session_id)
usage = result["usage"]
print(f"Total: {usage['total_tokens']} tokens, Messages: {usage['message_count']}")
```

## Compact Context

Summarize the conversation history to reduce token usage while preserving essential context. Returns before/after token counts.

```typescript
const result = await client.compactContext(sessionId);
console.log(`Before: ${result.before.totalTokens} tokens`);
console.log(`After: ${result.after.totalTokens} tokens`);
console.log(`Saved: ${result.before.totalTokens - result.after.totalTokens} tokens`);
```

```python
result = await client.compact_context(session_id)
saved = result["before"]["total_tokens"] - result["after"]["total_tokens"]
print(f"Compacted: saved {saved} tokens")
```

## Clear Context

Remove all messages from the session context. The session remains active with an empty conversation.

```typescript
await client.clearContext(sessionId);
```

```python
await client.clear_context(session_id)
```

## Auto-Compaction

Sessions can automatically compact when token usage exceeds a threshold. Configure this at session creation:

```typescript
await client.createSession({
  workspace: '/project',
  llm: { provider: 'anthropic', model: 'claude-sonnet-4-20250514', apiKey: '...' },
  autoCompact: true,
  autoCompactThreshold: 80,  // Compact when 80% of context budget is used
});
```

When auto-compaction triggers during an agentic loop, a `context_compact` event is emitted:

```typescript
for await (const event of session.stream('Long running task...')) {
  if (event.type === 'context_compact') {
    console.log(`Auto-compacted: ${event.beforeTokens} â†’ ${event.afterTokens} tokens`);
  }
}
```

## RPCs

| RPC | Description |
|-----|-------------|
| `getContextUsage(sessionId)` | Get token usage |
| `compactContext(sessionId)` | Compact conversation context |
| `clearContext(sessionId)` | Clear all context |
