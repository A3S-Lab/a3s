---
title: Jobs
description: Create, update, pause, resume, and remove scheduled jobs
---

# Jobs

A `CronJob` represents a scheduled task with a name, cron expression, shell command, status, and configuration.

## CronJob Structure

```rust
pub struct CronJob {
    pub id: String,                    // UUID (auto-generated)
    pub name: String,                  // Human-readable name
    pub schedule: String,              // Cron expression
    pub command: String,               // Shell command to execute
    pub status: JobStatus,             // Active | Paused | Running
    pub timeout_ms: u64,              // Default: 60000 (1 minute)
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
    pub last_run: Option<DateTime<Utc>>,
    pub next_run: Option<DateTime<Utc>>,
    pub run_count: u64,               // Successful executions
    pub fail_count: u64,              // Failed executions
    pub working_dir: Option<String>,  // Working directory for command
    pub env: Vec<(String, String)>,   // Environment variables
}
```

## Creating Jobs

### Via CronManager

```rust
let job = manager.add_job(
    "db-backup",                      // name
    "0 2 * * *",                      // schedule
    "pg_dump mydb > /backups/db.sql", // command
).await?;
```

The manager validates the cron expression, calculates `next_run`, and persists the job.

### Via Builder

For advanced configuration, build a `CronJob` directly:

```rust
use a3s_cron::CronJob;

let job = CronJob::new("db-backup", "0 2 * * *", "pg_dump mydb")
    .with_timeout(300_000)                    // 5 minutes
    .with_working_dir("/var/backups")
    .with_env("PGHOST", "localhost")
    .with_env("PGUSER", "backup_user")
    .with_env("PGDATABASE", "mydb");
```

## Job Status

```rust
pub enum JobStatus {
    Active,    // Will run on schedule
    Paused,    // Skipped by scheduler
    Running,   // Currently executing
}
```

### State Transitions

```
            add_job()
               │
               ▼
            Active ◄──── resume_job()
            │    │
  start exec│    │pause_job()
            │    │
            ▼    ▼
         Running  Paused
            │
            │ execution completes
            ▼
          Active
```

## CRUD Operations

### List Jobs

```rust
let jobs = manager.list_jobs().await?;
for job in &jobs {
    println!("[{}] {} - {} ({})",
        job.id, job.name, job.schedule, job.status);
}
```

### Get Job by ID or Name

```rust
let job = manager.get_job("job-uuid").await?;
let job = manager.get_job_by_name("db-backup").await?;
```

### Update Job

Update schedule, command, or timeout without recreating:

```rust
let updated = manager.update_job(
    &job.id,
    Some("0 3 * * *"),        // new schedule (or None to keep)
    Some("new-command.sh"),    // new command (or None to keep)
    Some(120_000),             // new timeout (or None to keep)
).await?;
```

### Pause and Resume

```rust
// Pause: scheduler skips this job
let job = manager.pause_job(&job.id).await?;
assert!(job.is_paused());

// Resume: scheduler includes this job again
let job = manager.resume_job(&job.id).await?;
assert!(job.is_active());
```

### Remove Job

Deletes the job and all its execution history:

```rust
manager.remove_job(&job.id).await?;
```

## Configuration

### Timeout

Default is 60,000ms (1 minute). Commands that exceed the timeout are killed:

```rust
let job = CronJob::new("long-task", "0 * * * *", "heavy-job.sh")
    .with_timeout(600_000);  // 10 minutes
```

### Working Directory

```rust
let job = CronJob::new("deploy", "0 0 * * *", "./deploy.sh")
    .with_working_dir("/opt/app");
```

### Environment Variables

```rust
let job = CronJob::new("notify", "0 9 * * 1-5", "send-report.sh")
    .with_env("SLACK_WEBHOOK", "https://hooks.slack.com/...")
    .with_env("REPORT_FORMAT", "pdf");
```

## Error Handling

```rust
use a3s_cron::CronError;

match manager.add_job("test", "invalid", "cmd").await {
    Ok(job) => println!("Created: {}", job.id),
    Err(CronError::InvalidExpression(msg)) =>
        println!("Bad schedule: {}", msg),
    Err(CronError::JobExists(name)) =>
        println!("Job already exists: {}", name),
    Err(e) => println!("Error: {}", e),
}
```

### Error Types

| Variant | Description |
|---------|-------------|
| `InvalidExpression(String)` | Invalid cron expression |
| `JobNotFound(String)` | Job ID not found |
| `JobExists(String)` | Job name already exists |
| `Storage(String)` | Persistence error |
| `Execution(String)` | Command execution error |
| `Timeout(u64)` | Command exceeded timeout |
| `Io(io::Error)` | File I/O error |
| `Serialization(serde_json::Error)` | JSON serialization error |
