---
title: 快速开始
description: 在任意支持的语言中快速上手 A3S Lane
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';

# 快速开始

## 安装

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">

```toml
[dependencies]
a3s-lane = "0.4"
tokio = { version = "1", features = ["full"] }
serde_json = "1"
```

四个特性（`distributed`、`metrics`、`monitoring`、`telemetry`）默认全部开启。仅使用核心队列：

```toml
a3s-lane = { version = "0.4", default-features = false }
```

</Tab>
<Tab value="Python">

```bash
pip install a3s-lane
```

支持 Python 3.9–3.13。提供 Linux（glibc/musl）、macOS 和 Windows 预构建 wheel。

</Tab>
<Tab value="Node.js">

```bash
npm install @a3s-lab/lane
```

支持 Node.js 16+。提供 Linux、macOS 和 Windows（x64/arm64）原生二进制。

</Tab>
</Tabs>

## 基本用法

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">

### 1. 定义命令

为你的任务实现 `Command` trait：

```rust
use a3s_lane::{Command, Result};
use async_trait::async_trait;
use serde_json::Value;

struct FetchData { url: String }

#[async_trait]
impl Command for FetchData {
    async fn execute(&self) -> Result<Value> {
        Ok(serde_json::json!({ "url": self.url }))
    }
    fn command_type(&self) -> &str { "fetch_data" }
}
```

### 2. 构建并启动

```rust
use a3s_lane::{EventEmitter, QueueManagerBuilder};

let emitter = EventEmitter::new(100);
let manager = QueueManagerBuilder::new(emitter)
    .with_default_lanes()
    .build().await?;

manager.start().await?;
```

### 3. 提交并等待结果

```rust
let rx = manager.submit("query", Box::new(FetchData {
    url: "https://api.example.com/data".into(),
})).await?;

let result = rx.await??;
println!("{result}");
```

`submit()` 返回 `oneshot::Receiver<Result<Value>>`，`??` 解包通道和命令结果。

### 4. 关闭

```rust
use std::time::Duration;
manager.shutdown().await;
manager.drain(Duration::from_secs(30)).await?;
```

</Tab>
<Tab value="Python">

```python
from a3s_lane import Lane

lane = Lane()   # 默认通道：system, control, query, session, skill, prompt
lane.start()

result = lane.submit("query", "fetch_data", {"url": "https://api.example.com/data"})

# 订阅生命周期事件
stream = lane.subscribe()
event = stream.recv(timeout_ms=1000)
if event:
    print(f"[{event.timestamp}] {event.key}")

lane.shutdown()
lane.drain(timeout_secs=30.0)
```

</Tab>
<Tab value="Node.js">

```js
const { Lane } = require('@a3s-lab/lane');

const lane = new Lane();   // 默认通道：system, control, query, session, skill, prompt
lane.start();

const result = JSON.parse(
  lane.submit('query', 'fetch_data', JSON.stringify({ url: 'https://api.example.com/data' }))
);

lane.subscribe((err, event) => {
  if (err) throw err;
  console.log(`[${event.timestamp}] ${event.key}`);
});

lane.shutdown();
lane.drain(30_000);
```

</Tab>
</Tabs>

## 自定义通道

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">

```rust
use a3s_lane::{QueueManagerBuilder, LaneConfig};

let manager = QueueManagerBuilder::new(emitter)
    .with_lane("high",  LaneConfig::new(1, 4), 0)
    .with_lane("low",   LaneConfig::new(1, 2), 1)
    .build().await?;
```

</Tab>
<Tab value="Python">

```python
from a3s_lane import Lane, LaneConfig

lane = Lane.with_lanes([
    LaneConfig("high", priority=0, min_concurrency=1, max_concurrency=4),
    LaneConfig("low",  priority=1, min_concurrency=1, max_concurrency=2),
])
lane.start()
```

</Tab>
<Tab value="Node.js">

```js
const { Lane } = require('@a3s-lab/lane');

const lane = Lane.withLanes([
  { laneId: 'high', priority: 0, minConcurrency: 1, maxConcurrency: 4 },
  { laneId: 'low',  priority: 1, minConcurrency: 1, maxConcurrency: 2 },
]);
lane.start();
```

</Tab>
</Tabs>

## 带可靠性（Rust）

添加超时、重试、死信队列和持久化存储：

```rust
use a3s_lane::*;
use std::{sync::Arc, time::Duration, path::PathBuf};

let storage = Arc::new(LocalStorage::new(PathBuf::from("./queue")).await?);

let manager = QueueManagerBuilder::new(emitter)
    .with_lane(
        "api",
        LaneConfig::new(1, 10)
            .with_timeout(Duration::from_secs(30))
            .with_retry_policy(RetryPolicy::exponential(3)),
        0,
    )
    .with_dlq(100)
    .with_storage(storage)
    .build().await?;
```

## 带可观测性（Rust）

添加指标和告警：

```rust
use a3s_lane::*;
use std::sync::Arc;

let manager = QueueManagerBuilder::new(emitter)
    .with_default_lanes()
    .with_metrics(QueueMetrics::local())
    .with_alerts(Arc::new(AlertManager::with_queue_depth_alerts(100, 500)))
    .build().await?;

let snapshot = manager.metrics().unwrap().snapshot().await;
println!("已提交: {:?}", snapshot.counters.get("lane.commands.submitted"));
```
