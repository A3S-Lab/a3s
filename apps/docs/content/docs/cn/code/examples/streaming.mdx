---
title: æµå¼ä¼ è¾“
description: ä½¿ç”¨ AgentEvent çš„å®æ—¶äº‹ä»¶æµ
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';

# æµå¼ä¼ è¾“

è®¢é˜… `AgentEvent` ä»¥å®æ—¶äº†è§£ agent çš„æ‰§è¡ŒçŠ¶æ€ â€” æ–‡æœ¬å¢é‡ã€å·¥å…·è°ƒç”¨ã€token ä½¿ç”¨é‡ç­‰ã€‚

## äº‹ä»¶ç±»å‹

| äº‹ä»¶ | è§¦å‘æ—¶æœº |
|-------|------|
| `Start` | Agent å¼€å§‹å¤„ç† |
| `TurnStart` / `TurnEnd` | æ¯ä¸ª LLM è½®æ¬¡ |
| `TextDelta` | æµå¼æ–‡æœ¬ç‰‡æ®µ |
| `ToolStart` / `ToolEnd` | å·¥å…·æ‰§è¡Œ |
| `ToolOutputDelta` | æµå¼å·¥å…·è¾“å‡ºï¼ˆbashï¼‰ |
| `ContextResolving` / `ContextResolved` | RAG æ£€ç´¢ |
| `End` | Agent å®Œæˆ |

## ç¤ºä¾‹

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">
```rust
use a3s_code_core::{Agent, AgentEvent, SessionOptions};

let session = agent.session("/my-project", Some(
    SessionOptions::new().with_permissive_policy()
))?;

let (mut rx, handle) = session.stream("Refactor the auth module", None).await?;

while let Some(event) = rx.recv().await {
    match event {
        AgentEvent::TextDelta { text } => print!("{text}"),
        AgentEvent::ToolStart { name, .. } => println!("\nğŸ”§ {name}..."),
        AgentEvent::ToolEnd { name, exit_code, .. } => {
            println!(" âœ“ (exit={})", exit_code);
        }
        AgentEvent::TurnEnd { turn, usage } => {
            println!("\nâ””â”€ Turn {turn} done ({} tokens)", usage.total_tokens);
        }
        AgentEvent::End { text, usage } => {
            println!("\nâ–  Done â€” {} tokens total", usage.total_tokens);
            break;
        }
        _ => {}
    }
}

handle.await??;
```

**æºç ï¼š** [`core/examples/agentic_loop_demo.rs`](https://github.com/A3S-Lab/Code/blob/main/core/examples/agentic_loop_demo.rs)
</Tab>
<Tab value="Python">
```python
session = agent.session("/my-project", permissive=True)

async for event in session.stream("Refactor the auth module"):
    t = event.get("type")
    if t == "text_delta":
        print(event["text"], end="", flush=True)
    elif t == "tool_start":
        print(f"\nğŸ”§ {event['name']}...", end="")
    elif t == "tool_end":
        print(f" âœ“ (exit={event['exit_code']})")
    elif t == "turn_end":
        print(f"\nâ””â”€ Turn {event['turn']} done ({event['usage']['total_tokens']} tokens)")
    elif t == "end":
        print(f"\nâ–  Done â€” {event['usage']['total_tokens']} tokens total")
        break
```

**æºç ï¼š** [`sdk/python/examples/agentic_loop_demo.py`](https://github.com/A3S-Lab/Code/blob/main/sdk/python/examples/agentic_loop_demo.py)
</Tab>
<Tab value="Node.js">
```javascript
const session = agent.session('/my-project', { permissive: true });

const stream = await session.stream('Refactor the auth module');

for await (const event of stream) {
  switch (event.type) {
    case 'text_delta':
      process.stdout.write(event.text);
      break;
    case 'tool_start':
      process.stdout.write(`\nğŸ”§ ${event.name}...`);
      break;
    case 'tool_end':
      console.log(` âœ“ (exit=${event.exitCode})`);
      break;
    case 'turn_end':
      console.log(`\nâ””â”€ Turn ${event.turn} done (${event.usage.totalTokens} tokens)`);
      break;
    case 'end':
      console.log(`\nâ–  Done â€” ${event.usage.totalTokens} tokens total`);
      break;
  }
}
```

**æºç ï¼š** [`sdk/node/examples/agentic_loop_demo.js`](https://github.com/A3S-Lab/Code/blob/main/sdk/node/examples/agentic_loop_demo.js)
</Tab>
</Tabs>

## ç¤ºä¾‹è¾“å‡º

```
â”Œâ”€ Turn 1
ğŸ”§ read... âœ“ (exit=0)
ğŸ”§ write... âœ“ (exit=0)
â””â”€ Turn 1 done (1842 tokens)
â”Œâ”€ Turn 2
The auth module has been refactored. Key changes:
- Extracted JWT validation into a separate function
- Added proper error types
- Improved test coverage
â””â”€ Turn 2 done (2103 tokens)
â–  Done â€” 3945 tokens total
```

## API å‚è€ƒ

### stream()

| æ–¹æ³• | Rust | Python | Node.js |
|--------|------|--------|---------|
| å¯åŠ¨æµ | `session.stream("prompt", None).await?` | `session.stream("prompt")` | `session.stream('prompt')` |
| æ¥æ”¶äº‹ä»¶ | `rx.recv().await` | `async for event in stream` | `for await (const event of stream)` |
| ç­‰å¾…å®Œæˆ | `handle.await??` | _ï¼ˆè‡ªåŠ¨ï¼‰_ | _ï¼ˆè‡ªåŠ¨ï¼‰_ |

### AgentEvent ç±»å‹

| äº‹ä»¶ | Rust å˜ä½“ | Python/Node.js `type` | å­—æ®µ |
|-------|-------------|----------------------|--------|
| Agent å¯åŠ¨ | `AgentEvent::Start` | `start` | â€” |
| LLM è½®æ¬¡å¼€å§‹ | `AgentEvent::TurnStart` | `turn_start` | `turn` |
| LLM è½®æ¬¡ç»“æŸ | `AgentEvent::TurnEnd` | `turn_end` | `turn`, `usage` |
| æ–‡æœ¬ç‰‡æ®µ | `AgentEvent::TextDelta` | `text_delta` | `text` |
| å·¥å…·å¼€å§‹ | `AgentEvent::ToolStart` | `tool_start` | `name`, `args` |
| å·¥å…·å®Œæˆ | `AgentEvent::ToolEnd` | `tool_end` | `name`, `exit_code`, `output` |
| å·¥å…·è¾“å‡ºç‰‡æ®µ | `AgentEvent::ToolOutputDelta` | `tool_output_delta` | `text` |
| RAG æ£€ç´¢ä¸­ | `AgentEvent::ContextResolving` | `context_resolving` | `query` |
| RAG æ£€ç´¢å®Œæˆ | `AgentEvent::ContextResolved` | `context_resolved` | `chunks` |
| Agent å®Œæˆ | `AgentEvent::End` | `end` | `text`, `usage` |
