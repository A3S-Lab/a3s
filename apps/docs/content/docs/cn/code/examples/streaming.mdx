---
title: æµå¼ä¼ è¾“
description: ä½¿ç”¨ AgentEvent çš„å®æ—¶äº‹ä»¶æµ
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';
import { TypeTable } from 'fumadocs-ui/components/type-table';

# æµå¼ä¼ è¾“

è®¢é˜… `AgentEvent` ä»¥å®æ—¶äº†è§£ agent çš„æ‰§è¡ŒçŠ¶æ€ â€” æ–‡æœ¬å¢é‡ã€å·¥å…·è°ƒç”¨ã€token ä½¿ç”¨é‡ç­‰ã€‚

## äº‹ä»¶ç±»å‹

<TypeTable
  type={
    {`\`Start\``}: {
      description: "Agent å¼€å§‹å¤„ç†",
    },
    {`\`TurnStart\` / \`TurnEnd\``}: {
      description: "æ¯ä¸ª LLM è½®æ¬¡",
    },
    {`\`TextDelta\``}: {
      description: "æµå¼æ–‡æœ¬ç‰‡æ®µ",
    },
    {`\`ToolStart\` / \`ToolEnd\``}: {
      description: "å·¥å…·æ‰§è¡Œ",
    },
    {`\`ToolOutputDelta\``}: {
      description: "æµå¼å·¥å…·è¾“å‡ºï¼ˆbashï¼‰",
    },
    {`\`ContextResolving\` / \`ContextResolved\``}: {
      description: "RAG æ£€ç´¢",
    },
    {`\`End\``}: {
      description: "Agent å®Œæˆ",
    },
  }
/>

## ç¤ºä¾‹

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">
```rust
use a3s_code_core::{Agent, AgentEvent, SessionOptions};

let session = agent.session("/my-project", Some(
    SessionOptions::new().with_permissive_policy()
))?;

let (mut rx, handle) = session.stream("Refactor the auth module", None).await?;

while let Some(event) = rx.recv().await {
    match event {
        AgentEvent::TextDelta { text } => print!("{text}"),
        AgentEvent::ToolStart { name, .. } => println!("\nğŸ”§ {name}..."),
        AgentEvent::ToolEnd { name, exit_code, .. } => {
            println!(" âœ“ (exit={})", exit_code);
        }
        AgentEvent::TurnEnd { turn, usage } => {
            println!("\nâ””â”€ Turn {turn} done ({} tokens)", usage.total_tokens);
        }
        AgentEvent::End { text, usage } => {
            println!("\nâ–  Done â€” {} tokens total", usage.total_tokens);
            break;
        }
        _ => {}
    }
}

handle.await??;
```

**æºç ï¼š** [`core/examples/agentic_loop_demo.rs`](https://github.com/A3S-Lab/Code/blob/main/core/examples/agentic_loop_demo.rs)
</Tab>
<Tab value="Python">
```python
session = agent.session("/my-project", permissive=True)

async for event in session.stream("Refactor the auth module"):
    t = event.get("type")
    if t == "text_delta":
        print(event["text"], end="", flush=True)
    elif t == "tool_start":
        print(f"\nğŸ”§ {event['name']}...", end="")
    elif t == "tool_end":
        print(f" âœ“ (exit={event['exit_code']})")
    elif t == "turn_end":
        print(f"\nâ””â”€ Turn {event['turn']} done ({event['usage']['total_tokens']} tokens)")
    elif t == "end":
        print(f"\nâ–  Done â€” {event['usage']['total_tokens']} tokens total")
        break
```

**æºç ï¼š** [`sdk/python/examples/agentic_loop_demo.py`](https://github.com/A3S-Lab/Code/blob/main/sdk/python/examples/agentic_loop_demo.py)
</Tab>
<Tab value="Node.js">
```javascript
const session = agent.session('/my-project', { permissive: true });

const stream = await session.stream('Refactor the auth module');

for await (const event of stream) {
  switch (event.type) {
    case 'text_delta':
      process.stdout.write(event.text);
      break;
    case 'tool_start':
      process.stdout.write(`\nğŸ”§ ${event.name}...`);
      break;
    case 'tool_end':
      console.log(` âœ“ (exit=${event.exitCode})`);
      break;
    case 'turn_end':
      console.log(`\nâ””â”€ Turn ${event.turn} done (${event.usage.totalTokens} tokens)`);
      break;
    case 'end':
      console.log(`\nâ–  Done â€” ${event.usage.totalTokens} tokens total`);
      break;
  }
}
```

**æºç ï¼š** [`sdk/node/examples/agentic_loop_demo.js`](https://github.com/A3S-Lab/Code/blob/main/sdk/node/examples/agentic_loop_demo.js)
</Tab>
</Tabs>

## ç¤ºä¾‹è¾“å‡º

```
â”Œâ”€ Turn 1
ğŸ”§ read... âœ“ (exit=0)
ğŸ”§ write... âœ“ (exit=0)
â””â”€ Turn 1 done (1842 tokens)
â”Œâ”€ Turn 2
The auth module has been refactored. Key changes:
- Extracted JWT validation into a separate function
- Added proper error types
- Improved test coverage
â””â”€ Turn 2 done (2103 tokens)
â–  Done â€” 3945 tokens total
```

## API å‚è€ƒ

### stream()

<TypeTable
  type={
    "å¯åŠ¨æµ": {
      description: {`Rust: \`session.stream("prompt", None).await?\` Â· Python: \`session.stream("prompt")\` Â· Node.js: \`session.stream('prompt')\``},
    },
    "æ¥æ”¶äº‹ä»¶": {
      description: {`Rust: \`rx.recv().await\` Â· Python: \`async for event in stream\` Â· Node.js: \`for await (const event of stream)\``},
    },
    "ç­‰å¾…å®Œæˆ": {
      description: {`Rust: \`handle.await??\` Â· Python: _ï¼ˆè‡ªåŠ¨ï¼‰_ Â· Node.js: _ï¼ˆè‡ªåŠ¨ï¼‰_`},
    },
  }
/>

### AgentEvent ç±»å‹

<TypeTable
  type={
    "Agent å¯åŠ¨": {
      description: {`Rust å˜ä½“: \`AgentEvent::Start\` Â· Python/Node.js \`type\`: \`start\``},
    },
    "LLM è½®æ¬¡å¼€å§‹": {
      description: {`Rust å˜ä½“: \`AgentEvent::TurnStart\` Â· Python/Node.js \`type\`: \`turn_start\` Â· å­—æ®µ: \`turn\``},
    },
    "LLM è½®æ¬¡ç»“æŸ": {
      description: {`Rust å˜ä½“: \`AgentEvent::TurnEnd\` Â· Python/Node.js \`type\`: \`turn_end\` Â· å­—æ®µ: \`turn\`, \`usage\``},
    },
    "æ–‡æœ¬ç‰‡æ®µ": {
      description: {`Rust å˜ä½“: \`AgentEvent::TextDelta\` Â· Python/Node.js \`type\`: \`text_delta\` Â· å­—æ®µ: \`text\``},
    },
    "å·¥å…·å¼€å§‹": {
      description: {`Rust å˜ä½“: \`AgentEvent::ToolStart\` Â· Python/Node.js \`type\`: \`tool_start\` Â· å­—æ®µ: \`name\`, \`args\``},
    },
    "å·¥å…·å®Œæˆ": {
      description: {`Rust å˜ä½“: \`AgentEvent::ToolEnd\` Â· Python/Node.js \`type\`: \`tool_end\` Â· å­—æ®µ: \`name\`, \`exit_code\`, \`output\``},
    },
    "å·¥å…·è¾“å‡ºç‰‡æ®µ": {
      description: {`Rust å˜ä½“: \`AgentEvent::ToolOutputDelta\` Â· Python/Node.js \`type\`: \`tool_output_delta\` Â· å­—æ®µ: \`text\``},
    },
    "RAG æ£€ç´¢ä¸­": {
      description: {`Rust å˜ä½“: \`AgentEvent::ContextResolving\` Â· Python/Node.js \`type\`: \`context_resolving\` Â· å­—æ®µ: \`query\``},
    },
    "RAG æ£€ç´¢å®Œæˆ": {
      description: {`Rust å˜ä½“: \`AgentEvent::ContextResolved\` Â· Python/Node.js \`type\`: \`context_resolved\` Â· å­—æ®µ: \`chunks\``},
    },
    "Agent å®Œæˆ": {
      description: {`Rust å˜ä½“: \`AgentEvent::End\` Â· Python/Node.js \`type\`: \`end\` Â· å­—æ®µ: \`text\`, \`usage\``},
    },
  }
/>
