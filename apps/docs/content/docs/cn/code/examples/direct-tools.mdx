---
title: 直接工具调用
description: 绕过 LLM 直接调用工具 — 适用于脚本编写、测试和自定义流水线
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';
import { TypeTable } from 'fumadocs-ui/components/type-table';
import { Callout } from 'fumadocs-ui/components/callout';

# 直接工具调用

无需 LLM 往返即可直接调用任何内置工具。适用于脚本编写、测试或在 A3S Code 工具层之上构建自定义流水线。

## 底层接口: `session.tool()`

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">
```rust
use a3s_code_core::{Agent, SessionOptions};

let agent = Agent::new("~/.a3s/config.hcl").await?;
let session = agent.session("/my-project", Some(
    SessionOptions::new().with_permissive_policy()
))?;

// 写入文件
let r = session.tool("write", serde_json::json!({
    "path": "hello.txt",
    "content": "来自直接工具调用的问候！"
})).await?;
println!("write: exit={}", r.exit_code);

// 读取文件
let r = session.tool("read", serde_json::json!({"path": "hello.txt"})).await?;
println!("内容: {}", r.output);

// 编辑文件
let r = session.tool("edit", serde_json::json!({
    "path": "hello.txt",
    "old_string": "问候",
    "new_string": "你好"
})).await?;
println!("edit: exit={}", r.exit_code);

// 搜索文件
let r = session.tool("glob", serde_json::json!({"pattern": "*.txt"})).await?;
println!("匹配: {}", r.output);

// 执行命令
let r = session.tool("bash", serde_json::json!({"command": "cat hello.txt"})).await?;
println!("bash: {}", r.output);

// 内容搜索
let r = session.tool("grep", serde_json::json!({"pattern": "你好", "path": "."})).await?;
println!("grep: {}", r.output);
```

**运行:** `cargo run --example 07_direct_tools`
**源码:** [`core/examples/07_direct_tools.rs`](https://github.com/A3S-Lab/Code/blob/main/core/examples/07_direct_tools.rs)
</Tab>
<Tab value="Python">
```python
session = agent.session("/my-project", permissive=True)

# 写入文件
r = await session.tool("write", {"path": "hello.txt", "content": "你好！"})
print(f"write: exit={r.exit_code}")

# 读取文件
r = await session.tool("read", {"path": "hello.txt"})
print(f"内容: {r.output}")

# 执行命令
r = await session.tool("bash", {"command": "cat hello.txt"})
print(f"bash: {r.output}")
```

**源码:** [`sdk/python/examples/advanced_features_demo.py`](https://github.com/A3S-Lab/Code/blob/main/sdk/python/examples/advanced_features_demo.py)
</Tab>
<Tab value="Node.js">
```javascript
const session = agent.session('/my-project', { permissive: true });

// 写入文件
const r1 = await session.tool('write', { path: 'hello.txt', content: '你好！' });
console.log(`write: exit=${r1.exitCode}`);

// 读取文件
const r2 = await session.tool('read', { path: 'hello.txt' });
console.log(`内容: ${r2.output}`);

// 执行命令
const r3 = await session.tool('bash', { command: 'cat hello.txt' });
console.log(`bash: ${r3.output}`);
```

**源码:** [`sdk/node/examples/advanced_features_demo.js`](https://github.com/A3S-Lab/Code/blob/main/sdk/node/examples/advanced_features_demo.js)
</Tab>
</Tabs>

## 便捷方法

常用操作的高级封装：

<Tabs groupId="lang" items={['Rust', 'Python', 'Node.js']}>
<Tab value="Rust">
```rust
// 读取文件
let content = session.read_file("src/main.rs").await?;

// 执行命令
let output = session.bash("cargo test").await?;

// 搜索文件
let files = session.glob("**/*.rs").await?;

// 搜索内容
let matches = session.grep("TODO").await?;
```
</Tab>
<Tab value="Python">
```python
content = await session.read_file("src/main.rs")
output = await session.bash("cargo test")
files = await session.glob("**/*.rs")
matches = await session.grep("TODO")
```
</Tab>
<Tab value="Node.js">
```javascript
const content = await session.readFile('src/main.rs');
const output = await session.bash('cargo test');
const files = await session.glob('**/*.rs');
const matches = await session.grep('TODO');
```
</Tab>
</Tabs>

<Callout type="info">
直接工具调用完全绕过 LLM — 不消耗 token，不产生流式事件。但仍然遵守会话的权限策略和工作区范围。
</Callout>

## API 参考

### session.tool()

<TypeTable
  type={{
    "通用工具调用": {
      description: "Rust: session.tool(name, args).await? · Python: await session.tool(name, args) · Node.js: await session.tool(name, args)",
    },
    "返回类型": {
      description: "ToolOutput { exit_code: i32, output: String }",
    },
  }}
/>

### 便捷方法

<TypeTable
  type={{
    "读取文件": {
      description: "Rust: session.read_file(path) · Python: session.read_file(path) · Node.js: session.readFile(path)",
    },
    "执行命令": {
      description: "Rust: session.bash(cmd) · Python: session.bash(cmd) · Node.js: session.bash(cmd)",
    },
    "搜索文件": {
      description: "Rust: session.glob(pattern) · Python: session.glob(pattern) · Node.js: session.glob(pattern)",
    },
    "搜索内容": {
      description: "Rust: session.grep(pattern) · Python: session.grep(pattern) · Node.js: session.grep(pattern)",
    },
  }}
/>
