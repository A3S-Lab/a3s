---
title: 部署
description: 使用 Helm、Docker 或独立二进制文件部署 A3S Gateway
---

# 部署

## Helm（Kubernetes）

A3S Gateway 附带一个生产就绪的 Helm chart，位于 `deploy/helm/a3s-gateway/`。

### 安装

```bash
helm install gateway deploy/helm/a3s-gateway
```

### 自定义配置

通过 `--set-file` 传入自定义 `gateway.hcl`：

```bash
helm install gateway deploy/helm/a3s-gateway \
  --set-file config=my-gateway.hcl
```

或覆盖单个值：

```bash
helm install gateway deploy/helm/a3s-gateway \
  --set replicaCount=3 \
  --set service.type=LoadBalancer \
  --set image.tag=0.1.0
```

### 自动扩缩容

```bash
helm install gateway deploy/helm/a3s-gateway \
  --set autoscaling.enabled=true \
  --set autoscaling.minReplicas=2 \
  --set autoscaling.maxReplicas=10 \
  --set autoscaling.targetCPUUtilizationPercentage=70
```

### Ingress

```bash
helm install gateway deploy/helm/a3s-gateway \
  --set ingress.enabled=true \
  --set ingress.className=nginx \
  --set ingress.hosts[0].host=api.example.com \
  --set ingress.hosts[0].paths[0].path=/ \
  --set ingress.hosts[0].paths[0].pathType=Prefix
```

### 控制台

控制台默认在 9090 端口启用：

```bash
kubectl port-forward svc/gateway-a3s-gateway 9090:9090
curl http://127.0.0.1:9090/api/gateway/health
```

### Helm Values

<TypeTable
  type={{
    replicaCount: { type: 'number', default: '1', description: 'Number of replicas' },
    'image.repository': { type: 'string', default: '"ghcr.io/a3s-lab/gateway"', description: 'Container image' },
    'image.tag': { type: 'string', default: 'Chart appVersion', description: 'Image tag' },
    'service.type': { type: 'string', default: '"ClusterIP"', description: 'Service type' },
    'service.port': { type: 'number', default: '8080', description: 'HTTP port' },
    'dashboard.enabled': { type: 'bool', default: 'true', description: 'Enable dashboard port' },
    'dashboard.port': { type: 'number', default: '9090', description: 'Dashboard port' },
    config: { type: 'string', default: 'minimal HCL', description: 'Gateway HCL configuration' },
    'resources.requests.cpu': { type: 'string', default: '"100m"', description: 'CPU request' },
    'resources.requests.memory': { type: 'string', default: '"64Mi"', description: 'Memory request' },
    'resources.limits.cpu': { type: 'string', default: '"500m"', description: 'CPU limit' },
    'resources.limits.memory': { type: 'string', default: '"256Mi"', description: 'Memory limit' },
    'autoscaling.enabled': { type: 'bool', default: 'false', description: 'Enable HPA' },
    'ingress.enabled': { type: 'bool', default: 'false', description: 'Enable Ingress' },
  }}
/>

### Chart 结构

```
deploy/helm/a3s-gateway/
├── Chart.yaml
├── values.yaml
└── templates/
    ├── _helpers.tpl
    ├── configmap.yaml       # gateway.hcl from values.config
    ├── deployment.yaml      # Pod spec with config volume
    ├── service.yaml         # ClusterIP with http + dashboard
    ├── serviceaccount.yaml
    ├── ingress.yaml         # Optional
    ├── hpa.yaml             # Optional
    └── NOTES.txt
```

ConfigMap 的校验和作为 Pod 注解包含其中，因此配置变更会自动触发滚动重启。

## Docker

```bash
docker run -d \
  -v $(pwd)/gateway.hcl:/etc/a3s-gateway/gateway.hcl \
  -p 8080:8080 \
  -p 9090:9090 \
  ghcr.io/a3s-lab/gateway:latest \
  --config /etc/a3s-gateway/gateway.hcl
```

## 二进制文件

```bash
# Download
curl -L https://github.com/A3S-Lab/Gateway/releases/latest/download/a3s-gateway -o a3s-gateway
chmod +x a3s-gateway

# Run
./a3s-gateway --config gateway.hcl

# Validate config
./a3s-gateway validate --config gateway.hcl

# Systemd service
cat > /etc/systemd/system/a3s-gateway.service << EOF
[Unit]
Description=A3S Gateway
After=network.target

[Service]
ExecStart=/usr/local/bin/a3s-gateway --config /etc/a3s-gateway/gateway.hcl
Restart=always
User=a3s-gateway

[Install]
WantedBy=multi-user.target
EOF

systemctl enable --now a3s-gateway
```

## Homebrew

```bash
brew tap a3s-lab/tap
brew install a3s-gateway
a3s-gateway --config gateway.hcl
```
